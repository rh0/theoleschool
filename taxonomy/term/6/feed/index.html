<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xml:base="http://theoleschool.com"  xmlns:dc="http://purl.org/dc/elements/1.1/">
<channel>
 <title>theoleschool - drupal</title>
 <link>http://theoleschool.com/tags/drupal</link>
 <description></description>
 <language>en</language>
<item>
 <title>Using Drupal Content Channel Tokens with Nodejs</title>
 <link>http://theoleschool.com/blog/using-drupal-content-channel-tokens-nodejs</link>
 <description>&lt;div class=&quot;field field-name-body field-type-text-with-summary field-label-hidden&quot;&gt;&lt;div class=&quot;field-items&quot;&gt;&lt;div class=&quot;field-item even&quot; property=&quot;content:encoded&quot;&gt;&lt;p&gt;You&#039;ve decided to add a bit of Node.js functionality to your Drupal site using the &lt;a href=&quot;https://drupal.org/project/nodejs&quot;&gt;Drupal Nodejs Module&lt;/a&gt;.  After &lt;a href=&quot;http://theoleschool.com/blog/module-development-nodejs-integration&quot;&gt;some reading&lt;/a&gt; you realize you need to be setting up user message channels using &lt;span class=&quot;geshifilter&quot;&gt;&lt;code class=&quot;php geshifilter-php&quot;&gt;hook_nodejs_user_channels&lt;/code&gt;&lt;/span&gt; or possibly &lt;span class=&quot;geshifilter&quot;&gt;&lt;code class=&quot;php geshifilter-php&quot;&gt;nodejs_add_user_to_channel&lt;/code&gt;&lt;/span&gt;. This allows your application to send socket messages to groups of users.  Great!  But you&#039;re writing no simple application. You want to go one step further and manage these channels based not only on some property of the user object, but all users who may be currently viewing a particular Drupal served page.  Suddenly the typical user channels no longer cut it. Try as you might, you&#039;ll find yourself quickly descending into channel management hell. There has got to be a better way. Thankfully content token channels are here to help.&lt;/p&gt;

&lt;h3&gt;Send a Message Based on the Content Being Viewed&lt;/h3&gt;

&lt;p&gt;You can think of content token channels as a per page (or piece of content) channel subscription.  This differs from the user channels in that it targets users who are currently viewing a specific page rather than users targeted by some property of the user object (regardless of where they are on the site).&lt;/p&gt;

&lt;p&gt;There are two main PHP functions to implement a token channel.  &lt;span class=&quot;geshifilter&quot;&gt;&lt;code class=&quot;php geshifilter-php&quot;&gt;nodejs_send_content_channel_token&lt;/code&gt;&lt;/span&gt; to generate a token channel for a given piece of content, and &lt;span class=&quot;geshifilter&quot;&gt;&lt;code class=&quot;php geshifilter-php&quot;&gt;nodejs_send_content_channel_message&lt;/code&gt;&lt;/span&gt; to send a message to users subscribed to a given content channel.&lt;/p&gt;

&lt;p&gt;To illustrate this lets assume we want to create a channel to send user messages when they are viewing a Drupal node of type &lt;em&gt;page&lt;/em&gt;.  To begin we will need to setup our content channel for that node type.  A good place to do this would be &lt;span class=&quot;geshifilter&quot;&gt;&lt;code class=&quot;php geshifilter-php&quot;&gt;hook_node_view&lt;/code&gt;&lt;/span&gt; which fires when a user views a node.&lt;/p&gt;

&lt;div class=&quot;geshifilter&quot;&gt;&lt;div class=&quot;php geshifilter-php&quot; style=&quot;font-family:monospace;&quot;&gt;&lt;span style=&quot;color: #000000; font-weight: bold;&quot;&gt;function&lt;/span&gt; example_node_view&lt;span style=&quot;color: #009900;&quot;&gt;&amp;#40;&lt;/span&gt;&lt;span style=&quot;color: #000088;&quot;&gt;$node&lt;/span&gt;&lt;span style=&quot;color: #339933;&quot;&gt;,&lt;/span&gt; &lt;span style=&quot;color: #000088;&quot;&gt;$view_mode&lt;/span&gt;&lt;span style=&quot;color: #339933;&quot;&gt;,&lt;/span&gt; &lt;span style=&quot;color: #000088;&quot;&gt;$langcode&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;&amp;#41;&lt;/span&gt; &lt;span style=&quot;color: #009900;&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br /&gt;
&amp;nbsp; &lt;span style=&quot;color: #b1b100;&quot;&gt;if&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;&amp;#40;&lt;/span&gt;&lt;span style=&quot;color: #000088;&quot;&gt;$node&lt;/span&gt;&lt;span style=&quot;color: #339933;&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #004000;&quot;&gt;type&lt;/span&gt; &lt;span style=&quot;color: #339933;&quot;&gt;==&lt;/span&gt; &lt;span style=&quot;color: #0000ff;&quot;&gt;&amp;quot;page&amp;quot;&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;&amp;#41;&lt;/span&gt; &lt;span style=&quot;color: #009900;&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br /&gt;
&amp;nbsp; &amp;nbsp; nodejs_send_content_channel_token&lt;span style=&quot;color: #009900;&quot;&gt;&amp;#40;&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;&#039;page_node_channel&#039;&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;&amp;#41;&lt;/span&gt;&lt;span style=&quot;color: #339933;&quot;&gt;;&lt;/span&gt;&lt;br /&gt;
&amp;nbsp; &lt;span style=&quot;color: #009900;&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br /&gt;
&lt;span style=&quot;color: #009900;&quot;&gt;&amp;#125;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Now every time a node of type &lt;em&gt;page&lt;/em&gt; is viewed the Node.js server is notified of the &lt;em&gt;page&amp;#95;node&amp;#95;channel&lt;/em&gt; content channel. Node.js then adds the channel to the user for whom the page was rendered.&lt;/p&gt;

&lt;p&gt;From here if we wish to send a message to all of the users viewing a node of type &lt;em&gt;page&lt;/em&gt; we make a simple call to &lt;span class=&quot;geshifilter&quot;&gt;&lt;code class=&quot;php geshifilter-php&quot;&gt;nodejs_send_content_channel_message&lt;/code&gt;&lt;/span&gt;.  When and where you choose to fire this message is up to you.  Possibly you want to notify users if the page they are viewing has been updated (&lt;span class=&quot;geshifilter&quot;&gt;&lt;code class=&quot;php geshifilter-php&quot;&gt;hook_node_update&lt;/code&gt;&lt;/span&gt;), a user logs in (&lt;span class=&quot;geshifilter&quot;&gt;&lt;code class=&quot;php geshifilter-php&quot;&gt;hook_user_login&lt;/code&gt;&lt;/span&gt;), or some new content was added (&lt;span class=&quot;geshifilter&quot;&gt;&lt;code class=&quot;php geshifilter-php&quot;&gt;hook_node_insert&lt;/code&gt;&lt;/span&gt;).&lt;/p&gt;

&lt;div class=&quot;geshifilter&quot;&gt;&lt;div class=&quot;php geshifilter-php&quot; style=&quot;font-family:monospace;&quot;&gt;&lt;span style=&quot;color: #666666; font-style: italic;&quot;&gt;// Build a message object&lt;/span&gt;&lt;br /&gt;
&lt;span style=&quot;color: #000088;&quot;&gt;$message&lt;/span&gt; &lt;span style=&quot;color: #339933;&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color: #000000; font-weight: bold;&quot;&gt;new&lt;/span&gt; stdClass&lt;span style=&quot;color: #009900;&quot;&gt;&amp;#40;&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;&amp;#41;&lt;/span&gt;&lt;span style=&quot;color: #339933;&quot;&gt;;&lt;/span&gt;&lt;br /&gt;
&lt;span style=&quot;color: #000088;&quot;&gt;$message&lt;/span&gt;&lt;span style=&quot;color: #339933;&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #004000;&quot;&gt;channel&lt;/span&gt; &lt;span style=&quot;color: #339933;&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color: #0000ff;&quot;&gt;&#039;page_node_channel&#039;&lt;/span&gt;&lt;span style=&quot;color: #339933;&quot;&gt;;&lt;/span&gt;&lt;br /&gt;
&lt;span style=&quot;color: #000088;&quot;&gt;$message&lt;/span&gt;&lt;span style=&quot;color: #339933;&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #004000;&quot;&gt;data&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;&amp;#91;&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;&#039;body&#039;&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;&amp;#93;&lt;/span&gt; &lt;span style=&quot;color: #339933;&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color: #0000ff;&quot;&gt;&#039;Hello World!&#039;&lt;/span&gt;&lt;span style=&quot;color: #339933;&quot;&gt;;&lt;/span&gt;&lt;br /&gt;
&lt;br /&gt;
&lt;span style=&quot;color: #666666; font-style: italic;&quot;&gt;// Send the message to the channel we created&lt;/span&gt;&lt;br /&gt;
nodejs_send_content_channel_message&lt;span style=&quot;color: #009900;&quot;&gt;&amp;#40;&lt;/span&gt;&lt;span style=&quot;color: #000088;&quot;&gt;$message&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;&amp;#41;&lt;/span&gt;&lt;span style=&quot;color: #339933;&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And that&#039;s about it!  When &lt;span class=&quot;geshifilter&quot;&gt;&lt;code class=&quot;php geshifilter-php&quot;&gt;nodejs_send_content_channel_message&lt;/code&gt;&lt;/span&gt; fires our message will be broadcast to all users subscribed to the page_node_channel.  In this case all users who are currently viewing a node of type &lt;em&gt;page&lt;/em&gt;.  This message behaves like any other on the Node.js side, so you could send it to a custom callback handler, as mentioned &lt;a href=&quot;http://theoleschool.com/blog/module-development-nodejs-integration&quot;&gt;in an earlier post&lt;/a&gt;.&lt;/p&gt;

&lt;h3&gt;Token Messages From an Node.js Extension&lt;/h3&gt;

&lt;p&gt;If you are writing a Node.js server extension and wish to send a message to a content channel, it is worth noting that there is no immediately exposed functionality to do this.  However, Node.js server extensions are aware of what the content channels are via &lt;span class=&quot;geshifilter&quot;&gt;&lt;code class=&quot;php geshifilter-php&quot;&gt;config&lt;span style=&quot;color: #339933;&quot;&gt;.&lt;/span&gt;tokenChannels&lt;/code&gt;&lt;/span&gt;. This allows us to mimic the functionality of the Drupal Node.js server with a helper method in our server extension.&lt;/p&gt;

&lt;div class=&quot;geshifilter&quot;&gt;&lt;div class=&quot;jquery geshifilter-jquery&quot; style=&quot;font-family:monospace;&quot;&gt;&lt;span style=&quot;color: #003366; font-weight: bold;&quot;&gt;function&lt;/span&gt; sendMessageToTokenChannel&lt;span style=&quot;color: #009900;&quot;&gt;&amp;#40;&lt;/span&gt;message&lt;span style=&quot;color: #339933;&quot;&gt;,&lt;/span&gt; config&lt;span style=&quot;color: #009900;&quot;&gt;&amp;#41;&lt;/span&gt; &lt;span style=&quot;color: #009900;&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br /&gt;
&amp;nbsp; &lt;span style=&quot;color: #000066; font-weight: bold;&quot;&gt;if&lt;/span&gt; &lt;span style=&quot;color: #009900;&quot;&gt;&amp;#40;&lt;/span&gt;&lt;span style=&quot;color: #339933;&quot;&gt;!&lt;/span&gt;message.&lt;span style=&quot;color: #660066;&quot;&gt;hasOwnProperty&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;&amp;#40;&lt;/span&gt;&lt;span style=&quot;color: #3366CC;&quot;&gt;&#039;channel&#039;&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;&amp;#41;&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;&amp;#41;&lt;/span&gt; &lt;span style=&quot;color: #009900;&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br /&gt;
&amp;nbsp; &amp;nbsp; console.&lt;span style=&quot;color: #660066;&quot;&gt;log&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;&amp;#40;&lt;/span&gt;&lt;span style=&quot;color: #3366CC;&quot;&gt;&#039;publishMessageToContentChannel: An invalid message object was provided.&#039;&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;&amp;#41;&lt;/span&gt;&lt;span style=&quot;color: #339933;&quot;&gt;;&lt;/span&gt;&lt;br /&gt;
&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #000066; font-weight: bold;&quot;&gt;return&lt;/span&gt;&lt;span style=&quot;color: #339933;&quot;&gt;;&lt;/span&gt;&lt;br /&gt;
&amp;nbsp; &lt;span style=&quot;color: #009900;&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br /&gt;
&amp;nbsp; &lt;span style=&quot;color: #000066; font-weight: bold;&quot;&gt;if&lt;/span&gt; &lt;span style=&quot;color: #009900;&quot;&gt;&amp;#40;&lt;/span&gt;&lt;span style=&quot;color: #339933;&quot;&gt;!&lt;/span&gt;config.&lt;span style=&quot;color: #660066;&quot;&gt;tokenChannels&lt;/span&gt;.&lt;span style=&quot;color: #660066;&quot;&gt;hasOwnProperty&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;&amp;#40;&lt;/span&gt;message.&lt;span style=&quot;color: #660066;&quot;&gt;channel&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;&amp;#41;&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;&amp;#41;&lt;/span&gt; &lt;span style=&quot;color: #009900;&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br /&gt;
&amp;nbsp; &amp;nbsp; console.&lt;span style=&quot;color: #660066;&quot;&gt;log&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;&amp;#40;&lt;/span&gt;&lt;span style=&quot;color: #3366CC;&quot;&gt;&#039;publishMessageToContentChannel: The channel &amp;quot;&#039;&lt;/span&gt; &lt;span style=&quot;color: #339933;&quot;&gt;+&lt;/span&gt; message.&lt;span style=&quot;color: #660066;&quot;&gt;channel&lt;/span&gt; &lt;span style=&quot;color: #339933;&quot;&gt;+&lt;/span&gt; &lt;span style=&quot;color: #3366CC;&quot;&gt;&#039;&amp;quot; doesn&lt;span style=&quot;color: #000099; font-weight: bold;&quot;&gt;\&#039;&lt;/span&gt;t exist.&#039;&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;&amp;#41;&lt;/span&gt;&lt;span style=&quot;color: #339933;&quot;&gt;;&lt;/span&gt;&lt;br /&gt;
&amp;nbsp; &amp;nbsp; &lt;span style=&quot;color: #000066; font-weight: bold;&quot;&gt;return&lt;/span&gt;&lt;span style=&quot;color: #339933;&quot;&gt;;&lt;/span&gt;&lt;br /&gt;
&amp;nbsp; &lt;span style=&quot;color: #009900;&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br /&gt;
&lt;br /&gt;
&amp;nbsp; &lt;span style=&quot;color: #000066; font-weight: bold;&quot;&gt;for&lt;/span&gt; &lt;span style=&quot;color: #009900;&quot;&gt;&amp;#40;&lt;/span&gt;&lt;span style=&quot;color: #003366; font-weight: bold;&quot;&gt;var&lt;/span&gt; socketId &lt;span style=&quot;color: #000066; font-weight: bold;&quot;&gt;in&lt;/span&gt; config.&lt;span style=&quot;color: #660066;&quot;&gt;tokenChannels&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;&amp;#91;&lt;/span&gt;message.&lt;span style=&quot;color: #660066;&quot;&gt;channel&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;&amp;#93;&lt;/span&gt;.&lt;span style=&quot;color: #660066;&quot;&gt;sockets&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;&amp;#41;&lt;/span&gt; &lt;span style=&quot;color: #009900;&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br /&gt;
&amp;nbsp; &amp;nbsp; config.&lt;span style=&quot;color: #660066;&quot;&gt;publishMessageToClient&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;&amp;#40;&lt;/span&gt;socketId&lt;span style=&quot;color: #339933;&quot;&gt;,&lt;/span&gt; message&lt;span style=&quot;color: #009900;&quot;&gt;&amp;#41;&lt;/span&gt;&lt;span style=&quot;color: #339933;&quot;&gt;;&lt;/span&gt;&lt;br /&gt;
&amp;nbsp; &lt;span style=&quot;color: #009900;&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br /&gt;
&lt;span style=&quot;color: #009900;&quot;&gt;&amp;#125;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Adding this  method to your server extension, will allow you to send messages to a content channel, by passing the message and config objects from within your &lt;span class=&quot;geshifilter&quot;&gt;&lt;code class=&quot;php geshifilter-php&quot;&gt;exports&lt;span style=&quot;color: #339933;&quot;&gt;.&lt;/span&gt;setup&lt;/code&gt;&lt;/span&gt; function.&lt;/p&gt;

&lt;p&gt;Using content token channels has greatly simplified several of the Drupal/Node.js projects I have done.  However, it wasn&#039;t immediately apparent that this functionality existed.  So I hope this helps to further clarify the capabilities of this module.&lt;/p&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;</description>
 <pubDate>Mon, 28 Apr 2014 17:29:06 +0000</pubDate>
 <dc:creator>rho</dc:creator>
 <guid isPermaLink="false">165 at http://theoleschool.com</guid>
</item>
<item>
 <title>Hubot Drush me Drupal</title>
 <link>http://theoleschool.com/blog/hubot-drush-me-drupal</link>
 <description>&lt;div class=&quot;field field-name-body field-type-text-with-summary field-label-hidden&quot;&gt;&lt;div class=&quot;field-items&quot;&gt;&lt;div class=&quot;field-item even&quot; property=&quot;content:encoded&quot;&gt;&lt;p&gt;Recently the company I work for shifted the bulk of our instant message communications over to &lt;a href=&quot;http://campfirenow.com/&quot;&gt;Campfire&lt;/a&gt;, and established a series of rooms to discuss our various projects.  This transition seemed to go fairly well, once everyone settled on their preferred client interface.  I was used to using IRC and found a &lt;a href=&quot;https://github.com/zerowidth/camper_van&quot;&gt;nice little Ruby gem&lt;/a&gt; that piped Campfire through my IRC client.  Chatting in this environment quickly had me missing Druplicon, the friendly Drupal fueled chat bot that tirelessly serves the Drupal IRC community.  I decided to look for a replacement, and after some searching I stumbled upon &lt;a href=&quot;http://hubot.github.com/&quot;&gt;Hubot&lt;/a&gt;, a Node.js powered chat bot. It was initially built by the folks at GitHub and includes a long list of &lt;a href=&quot;http://hubot-script-catalog.herokuapp.com/&quot;&gt;plugin scripts&lt;/a&gt; added by community developers.  This was immediately appealing for several reasons:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;It is built using Node.js&lt;/li&gt;
&lt;li&gt;It is written in Coffeescript (something I have wanted to try my hand at for a while)&lt;/li&gt;
&lt;li&gt;Additional scripts appeared easy to write, and plugin simply&lt;/li&gt;
&lt;li&gt;It has built in Campfire integration&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;So I installed Hubot on a small server, with a handful of scripts that I thought would be useful and fun for our team.  Adding the bot to our Campfire rooms was fairly painless, and after writing a small init script we were good to go.  This sparked some discussion among our team about how the bot was deployed, cool ways it could be extended, and methods of use.  A fellow developer, &lt;a href=&quot;http://davidfells.net/&quot;&gt;David Fells&lt;/a&gt;, mentioned that it would be handy if we could tell Hubot to execute &lt;a href=&quot;http://drupal.org/project/drush&quot;&gt;Drush&lt;/a&gt; commands.  This gave me pause, and after a quick:&lt;/p&gt;

&lt;p&gt;&quot;That&#039;s a great idea! You mind if I implement that?&quot;&lt;br /&gt;
&quot;Sure, go for it.&quot;&lt;/p&gt;

&lt;p&gt;I found myself firing up my editor, trying a few test methods, and reading up on &lt;a href=&quot;http://coffeescript.org/&quot;&gt;CoffeeScript&lt;/a&gt;. Things moved fairly quickly, once I got going.  I realized &lt;a href=&quot;http://nodejs.org/api/child_process.html#child_process_child_process_spawn_command_args_options&quot;&gt;&lt;code&gt;child_process.spawn()&lt;/code&gt;&lt;/a&gt;was going to be my friend, a core Node method that I had yet to use.  Generally CoffeeScript proved to be the biggest challenge.  While writing the initial prototype I actually used a &lt;a href=&quot;http://js2coffee.org/&quot;&gt;JavaScript to CoffeScript translator&lt;/a&gt; and was cursing the whole time.  However, by the time I was putting the finishing touches on my methods and objects I found myself smiling as I wrote in this almost comical syntax.  Simply put, CoffeeScript is fun! I still find myself favoring the comforting structure of the curly braces and semicolons when working with JavaScript, but now that all seems  somewhat gray and drab, knowing there is something much more playful out there.&lt;/p&gt;

&lt;p&gt;As you can imagine there were, and are, several security concerns.  The early prototype actually had user commands pipe right into Drush which is a security nightmare.  Any user with access to the bot could escape or pipe in any old Bash command directly through the bot.  Further, any Drupal installation that Drush is aware of would be at the mercy of users who may or may not have the best intentions at heart. Needless to say this approach was quickly abandoned in favor of a hand picked list of commands made available to the bot.  This caused the code to be a bit more tedious, and likely less elegant, but I needed to insure that Drush would be executing the allowed commands, and nothing more.  After some discussion I also decided to weed the available commands down to a relatively innocuous set (giving information vs. actually changing something).  I attempted to structure the code in a way that it would not be difficult for another developer to add commands. Overall, I&#039;m pretty happy with the &lt;a href=&quot;https://github.com/github/hubot-scripts/blob/master/src/scripts/drush.coffee&quot;&gt;end result&lt;/a&gt;, and the pull request was soon accepted.  You can find this script along with all of the other &lt;a href=&quot;http://hubot-script-catalog.herokuapp.com/#drush.coffee&quot;&gt;Hubot scripts on GitHub&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;&lt;strong&gt;tl;dr&lt;/strong&gt; If you&#039;re looking for a fun chatbot for campfire (or otherwise) check out &lt;a href=&quot;http://hubot.github.com/&quot;&gt;Hubot&lt;/a&gt; and enable &lt;a href=&quot;http://hubot-script-catalog.herokuapp.com/#drush.coffee&quot;&gt;drush.coffee&lt;/a&gt; if you&#039;d like that bot to have cool Drush functionality.&lt;/em&gt;&lt;/p&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;</description>
 <pubDate>Wed, 08 May 2013 04:15:48 +0000</pubDate>
 <dc:creator>rho</dc:creator>
 <guid isPermaLink="false">163 at http://theoleschool.com</guid>
</item>
<item>
 <title>Talking to Drupal with Node.js</title>
 <link>http://theoleschool.com/blog/talking-drupal-nodejs</link>
 <description>&lt;div class=&quot;field field-name-body field-type-text-with-summary field-label-hidden&quot;&gt;&lt;div class=&quot;field-items&quot;&gt;&lt;div class=&quot;field-item even&quot; property=&quot;content:encoded&quot;&gt;&lt;p&gt;As I&#039;ve mentioned in a &lt;a href=&quot;/blog/module-development-nodejs-integration&quot;&gt;previous post&lt;/a&gt; sending messages from Drupal to Node is fairly easy to accomplish.  However, that is only part of the equation. If we&#039;re really wanting to build a larger, more complex Node application, it won&#039;t be long before we need the client to talk to the Node server and possibly the Node server to talk to Drupal.  At a glance it isn&#039;t terribly obvious how to do this with the &lt;a href=&quot;http://drupal.org/project/nodejs&quot;&gt;nodejs integration module&lt;/a&gt;, but it turns  out there are a few tools tucked in the module code that come to the rescue.&lt;/p&gt;
&lt;p&gt;This post will assume some familiarity with the use of the server extension functionality built into the nodejs module.  If you are unfamiliar with this, have a look at the &lt;a href=&quot;http://drupalcode.org/project/nodejs.git/blob/4dd8f7808feb70d2f71c6978336ffeaed7eef65a:/nodejs.server.extension.js.example&quot;&gt;example server extension&lt;/a&gt; included with the module.  In short it does what you might think, allowing other modules to extend the nodejs server setup by the nodejs module.  For context I&#039;ve posted a fully commented &lt;a href=&quot;https://github.com/rh0/node_to_drupal&quot;&gt;example module&lt;/a&gt; to GitHub from which the code snippets of this post are taken.&lt;/p&gt;
&lt;p&gt;If you are familiar with writing node apps with &lt;a href=&quot;http://socket.io/&quot;&gt;Socket.io&lt;/a&gt; then you are likely already familiar with client side communication back to the node server.  Typically you will have a &lt;span class=&quot;geshifilter&quot;&gt;&lt;code class=&quot;php geshifilter-php&quot;&gt;socket&lt;span style=&quot;color: #339933;&quot;&gt;.&lt;/span&gt;emit&lt;/code&gt;&lt;/span&gt; on the client side, and a listener to handle the message event on the server side.  The same is true when using the nodejs module.  In this example I&#039;m building a very simple form with Drupal and displaying it on a page.  When the submit button is hit, a bit of client side javascript emits a message through socket.io which is in the &lt;span class=&quot;geshifilter&quot;&gt;&lt;code class=&quot;php geshifilter-php&quot;&gt;Drupal&lt;span style=&quot;color: #339933;&quot;&gt;.&lt;/span&gt;Nodejs&lt;/code&gt;&lt;/span&gt; object. &lt;/p&gt;
&lt;div class=&quot;geshifilter&quot;&gt;&lt;div class=&quot;jquery geshifilter-jquery&quot; style=&quot;font-family:monospace;&quot;&gt;&lt;span style=&quot;color: #006600; font-style: italic;&quot;&gt;// A simple message.  The listener on the server side does not like us to&lt;/span&gt;&lt;br /&gt;&lt;span style=&quot;color: #006600; font-style: italic;&quot;&gt;// specify &#039;messageType&#039; so we&#039;re calling it &#039;type&#039; for now.&lt;/span&gt;&lt;br /&gt;&lt;span style=&quot;color: #003366; font-weight: bold;&quot;&gt;var&lt;/span&gt; message &lt;span style=&quot;color: #339933;&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color: #009900;&quot;&gt;{&lt;/span&gt;&lt;br /&gt;
  type&lt;span style=&quot;color: #339933;&quot;&gt;:&lt;/span&gt; &lt;span style=&quot;color: #3366CC;&quot;&gt;&#039;nodeToDrupal&#039;&lt;/span&gt;&lt;span style=&quot;color: #339933;&quot;&gt;,&lt;/span&gt;&lt;br /&gt;
  messageBody&lt;span style=&quot;color: #339933;&quot;&gt;:&lt;/span&gt; &lt;span style=&quot;color: #3366CC;&quot;&gt;&#039;Hello from the client side!&#039;&lt;/span&gt;&lt;br /&gt;&lt;span style=&quot;color: #009900;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #339933;&quot;&gt;;&lt;/span&gt;&lt;br /&gt;&lt;br /&gt;
Drupal.&lt;span style=&quot;color: #660066;&quot;&gt;behaviors&lt;/span&gt;.&lt;span style=&quot;color: #660066;&quot;&gt;sendDrupalMessage&lt;/span&gt; &lt;span style=&quot;color: #339933;&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color: #009900;&quot;&gt;{&lt;/span&gt;&lt;br /&gt;
  attach&lt;span style=&quot;color: #339933;&quot;&gt;:&lt;/span&gt; &lt;span style=&quot;color: #003366; font-weight: bold;&quot;&gt;function&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;(&lt;/span&gt;&lt;a href=&quot;http://docs.jquery.com/Core/context&quot;&gt;&lt;span style=&quot;color: #000066;&quot;&gt;context&lt;/span&gt;&lt;/a&gt;&lt;span style=&quot;color: #339933;&quot;&gt;,&lt;/span&gt; settings&lt;span style=&quot;color: #009900;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #009900;&quot;&gt;{&lt;/span&gt;&lt;br /&gt;
    &lt;span style=&quot;color: #006600; font-style: italic;&quot;&gt;// Have our message emitter fire on form submission.&lt;/span&gt;&lt;br /&gt;
    &lt;span style=&quot;color: #000066;&quot;&gt;$&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #3366CC;&quot;&gt;&quot;#node-to-drupal-form&quot;&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;)&lt;/span&gt;.&lt;a href=&quot;http://docs.jquery.com/Events/submit&quot;&gt;&lt;span style=&quot;color: #000066;&quot;&gt;submit&lt;/span&gt;&lt;/a&gt;&lt;span style=&quot;color: #009900;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #003366; font-weight: bold;&quot;&gt;function&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #009900;&quot;&gt;{&lt;/span&gt;&lt;br /&gt;
      Drupal.&lt;span style=&quot;color: #660066;&quot;&gt;Nodejs&lt;/span&gt;.&lt;span style=&quot;color: #660066;&quot;&gt;socket&lt;/span&gt;.&lt;span style=&quot;color: #660066;&quot;&gt;emit&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #3366CC;&quot;&gt;&#039;message&#039;&lt;/span&gt;&lt;span style=&quot;color: #339933;&quot;&gt;,&lt;/span&gt; message&lt;span style=&quot;color: #009900;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #339933;&quot;&gt;;&lt;/span&gt;&lt;br /&gt;
      &lt;span style=&quot;color: #000066; font-weight: bold;&quot;&gt;return&lt;/span&gt; &lt;span style=&quot;color: #003366; font-weight: bold;&quot;&gt;false&lt;/span&gt;&lt;span style=&quot;color: #339933;&quot;&gt;;&lt;/span&gt;&lt;br /&gt;
    &lt;span style=&quot;color: #009900;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #339933;&quot;&gt;;&lt;/span&gt;&lt;br /&gt;
  &lt;span style=&quot;color: #009900;&quot;&gt;}&lt;/span&gt;&lt;br /&gt;&lt;span style=&quot;color: #009900;&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;On the server side, in our server extension file, we need to catch our message.  This is done in a fairly standard way, the event we are listening for is &lt;span class=&quot;geshifilter&quot;&gt;&lt;code class=&quot;php geshifilter-php&quot;&gt;client&lt;span style=&quot;color: #339933;&quot;&gt;-&lt;/span&gt;message&lt;/code&gt;&lt;/span&gt;.&lt;/p&gt;
&lt;div class=&quot;geshifilter&quot;&gt;&lt;div class=&quot;jquery geshifilter-jquery&quot; style=&quot;font-family:monospace;&quot;&gt; &lt;br /&gt;
exports.&lt;span style=&quot;color: #660066;&quot;&gt;setup&lt;/span&gt; &lt;span style=&quot;color: #339933;&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color: #003366; font-weight: bold;&quot;&gt;function&lt;/span&gt; &lt;span style=&quot;color: #009900;&quot;&gt;(&lt;/span&gt;config&lt;span style=&quot;color: #009900;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #009900;&quot;&gt;{&lt;/span&gt;&lt;br /&gt;
  process.&lt;span style=&quot;color: #660066;&quot;&gt;on&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #3366CC;&quot;&gt;&#039;client-message&#039;&lt;/span&gt;&lt;span style=&quot;color: #339933;&quot;&gt;,&lt;/span&gt; &lt;span style=&quot;color: #003366; font-weight: bold;&quot;&gt;function&lt;/span&gt; &lt;span style=&quot;color: #009900;&quot;&gt;(&lt;/span&gt;sessionId&lt;span style=&quot;color: #339933;&quot;&gt;,&lt;/span&gt; message&lt;span style=&quot;color: #009900;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #009900;&quot;&gt;{&lt;/span&gt;&lt;br /&gt;
    &lt;span style=&quot;color: #006600; font-style: italic;&quot;&gt;// Logging the message to the console.&lt;/span&gt;&lt;br /&gt;
    console.&lt;span style=&quot;color: #660066;&quot;&gt;log&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #3366CC;&quot;&gt;&#039;Got a message from the client.  Take a look: &#039;&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #339933;&quot;&gt;;&lt;/span&gt;&lt;br /&gt;
    console.&lt;span style=&quot;color: #660066;&quot;&gt;log&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;(&lt;/span&gt;message&lt;span style=&quot;color: #009900;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #339933;&quot;&gt;;&lt;/span&gt;&lt;br /&gt;
  &lt;span style=&quot;color: #009900;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #339933;&quot;&gt;;&lt;/span&gt;&lt;br /&gt;&lt;span style=&quot;color: #009900;&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;If a client message comes through, we log it to the console.  For a lot of node applications our worries are over.  We have a way for the client to send a message to the node server.  From there we can have the node server do whatever we would like with it.  Maybe spit a message back out to the client, to a different session, to a Redis store, or any number of other things.  Now the big question.  What if we want the node server to send a message to Drupal?  There are several reasons we may want to do this, but chief among them would be a database write.  The idea of having node write directly to the Drupal database, while possible, would surely harm large baskets full of kittens.  It&#039;s a bad idea.  So we need node to tell Drupal to do its bidding, and for that we need to look at a &lt;span class=&quot;geshifilter&quot;&gt;&lt;code class=&quot;php geshifilter-php&quot;&gt;hook_nodejs_message_callback&lt;/code&gt;&lt;/span&gt;.  This hook allows us to assign handler functions to various message types that being emitted from the node server, and is wonderfully simple.&lt;/p&gt;
&lt;div class=&quot;geshifilter&quot;&gt;&lt;div class=&quot;drupal6 geshifilter-drupal6&quot; style=&quot;font-family:monospace;&quot;&gt;&lt;span style=&quot;color: #000000; font-weight: bold;&quot;&gt;function&lt;/span&gt; node_to_drupal_nodejs_message_callback&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;$type&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #66cc66;&quot;&gt;{&lt;/span&gt;&lt;br /&gt;
  &lt;span style=&quot;color: #b1b100;&quot;&gt;switch&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;$type&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #66cc66;&quot;&gt;{&lt;/span&gt;&lt;br /&gt;
    &lt;span style=&quot;color: #b1b100;&quot;&gt;case&lt;/span&gt; &lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;nodeToDrupal&#039;&lt;/span&gt;:&lt;br /&gt;
      &lt;span style=&quot;color: #b1b100;&quot;&gt;return&lt;/span&gt; &lt;a href=&quot;http://www.php.net/array&quot;&gt;&lt;span style=&quot;color: #000066;&quot;&gt;array&lt;/span&gt;&lt;/a&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;node_to_drupal_handler&#039;&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt;;&lt;br /&gt;
  &lt;span style=&quot;color: #66cc66;&quot;&gt;}&lt;/span&gt;&lt;br /&gt;
  &lt;span style=&quot;color: #b1b100;&quot;&gt;return&lt;/span&gt; &lt;span style=&quot;color: #000000; font-weight: bold;&quot;&gt;false&lt;/span&gt;;&lt;br /&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The hook is fired on an &lt;span class=&quot;geshifilter&quot;&gt;&lt;code class=&quot;php geshifilter-php&quot;&gt;sendMessageToBackend&lt;/code&gt;&lt;/span&gt; call from the node server and passes in &lt;span class=&quot;geshifilter&quot;&gt;&lt;code class=&quot;php geshifilter-php&quot;&gt;messageType&lt;/code&gt;&lt;/span&gt; from the message.  In our case the type is &lt;span class=&quot;geshifilter&quot;&gt;&lt;code class=&quot;php geshifilter-php&quot;&gt;nodeToDrupal&lt;/code&gt;&lt;/span&gt; (more on this in a bit).  The hook is expected to return and array of function names, that will subsequently be called.   In this case &lt;span class=&quot;geshifilter&quot;&gt;&lt;code class=&quot;php geshifilter-php&quot;&gt;node_to_drupal_handler&lt;/code&gt;&lt;/span&gt;.&lt;/p&gt;
&lt;div class=&quot;geshifilter&quot;&gt;&lt;div class=&quot;drupal6 geshifilter-drupal6&quot; style=&quot;font-family:monospace;&quot;&gt;&lt;span style=&quot;color: #000000; font-weight: bold;&quot;&gt;function&lt;/span&gt; node_to_drupal_handler&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;$message&lt;/span&gt;, &lt;span style=&quot;color: #66cc66;&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;$responce&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #66cc66;&quot;&gt;{&lt;/span&gt;&lt;br /&gt;
  &lt;span style=&quot;color: #808080; font-style: italic;&quot;&gt;// Grab our messageBody from the client message and post it to the watchdog.&lt;/span&gt;&lt;br /&gt;
  &lt;a href=&quot;http://api.drupal.org/api/function/watchdog/6&quot;&gt;&lt;span style=&quot;color: #000066;&quot;&gt;watchdog&lt;/span&gt;&lt;/a&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;node_to_drupal&#039;&lt;/span&gt;, &lt;span style=&quot;color: #0000ff;&quot;&gt;$message&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;messageBody&#039;&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;]&lt;/span&gt;, &lt;a href=&quot;http://www.php.net/array&quot;&gt;&lt;span style=&quot;color: #000066;&quot;&gt;array&lt;/span&gt;&lt;/a&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt;, &lt;a href=&quot;http://api.drupal.org/api/constant/WATCHDOG_INFO/6&quot;&gt;&lt;span style=&quot;color: #000000; font-weight: bold;&quot;&gt;WATCHDOG_INFO&lt;/span&gt;&lt;/a&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt;;&lt;br /&gt;
  &lt;span style=&quot;color: #808080; font-style: italic;&quot;&gt;// Tell node we got the message.&lt;/span&gt;&lt;br /&gt;
  &lt;span style=&quot;color: #0000ff;&quot;&gt;$responce&lt;/span&gt; = &lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;Message logged to Watchdog!&#039;&lt;/span&gt;;&lt;br /&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The handler functions called from &lt;span class=&quot;geshifilter&quot;&gt;&lt;code class=&quot;php geshifilter-php&quot;&gt;hook_nodejs_message_callback&lt;/code&gt;&lt;/span&gt; expect two parameters.  The message from node (as an array), and a response passed by reference.  In this example we&#039;re make a simple watchdog entry of the &lt;span class=&quot;geshifilter&quot;&gt;&lt;code class=&quot;php geshifilter-php&quot;&gt;messageBody&lt;/code&gt;&lt;/span&gt;, and adding a string to the response stating that Drupal got the message.&lt;/p&gt;
&lt;p&gt;Going back to our node server extension, we&#039;re going to fire the message we got from the client over to Drupal.  To do this were going to use a handy function in our config variable called &lt;span class=&quot;geshifilter&quot;&gt;&lt;code class=&quot;php geshifilter-php&quot;&gt;sendMessageToBackend&lt;/code&gt;&lt;/span&gt;.  Our server extension code is now looking like:
&lt;/p&gt;&lt;div class=&quot;geshifilter&quot;&gt;&lt;div class=&quot;jquery geshifilter-jquery&quot; style=&quot;font-family:monospace;&quot;&gt;exports.&lt;span style=&quot;color: #660066;&quot;&gt;setup&lt;/span&gt; &lt;span style=&quot;color: #339933;&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color: #003366; font-weight: bold;&quot;&gt;function&lt;/span&gt; &lt;span style=&quot;color: #009900;&quot;&gt;(&lt;/span&gt;config&lt;span style=&quot;color: #009900;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #009900;&quot;&gt;{&lt;/span&gt;&lt;br /&gt;
  process.&lt;span style=&quot;color: #660066;&quot;&gt;on&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #3366CC;&quot;&gt;&#039;client-message&#039;&lt;/span&gt;&lt;span style=&quot;color: #339933;&quot;&gt;,&lt;/span&gt; &lt;span style=&quot;color: #003366; font-weight: bold;&quot;&gt;function&lt;/span&gt; &lt;span style=&quot;color: #009900;&quot;&gt;(&lt;/span&gt;sessionId&lt;span style=&quot;color: #339933;&quot;&gt;,&lt;/span&gt; message&lt;span style=&quot;color: #009900;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #009900;&quot;&gt;{&lt;/span&gt;&lt;br /&gt;
    &lt;span style=&quot;color: #006600; font-style: italic;&quot;&gt;// Logging the message to the console.&lt;/span&gt;&lt;br /&gt;
    console.&lt;span style=&quot;color: #660066;&quot;&gt;log&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #3366CC;&quot;&gt;&#039;Got a message from the client.  Take a look: &#039;&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #339933;&quot;&gt;;&lt;/span&gt;&lt;br /&gt;
    console.&lt;span style=&quot;color: #660066;&quot;&gt;log&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;(&lt;/span&gt;message&lt;span style=&quot;color: #009900;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #339933;&quot;&gt;;&lt;/span&gt;&lt;br /&gt;&lt;br /&gt;
    &lt;span style=&quot;color: #006600; font-style: italic;&quot;&gt;// Insuring that messageType is set before passing along.&lt;/span&gt;&lt;br /&gt;
    message.&lt;span style=&quot;color: #660066;&quot;&gt;messageType&lt;/span&gt; &lt;span style=&quot;color: #339933;&quot;&gt;=&lt;/span&gt; message.&lt;span style=&quot;color: #660066;&quot;&gt;type&lt;/span&gt;&lt;span style=&quot;color: #339933;&quot;&gt;;&lt;/span&gt;&lt;br /&gt;
    &lt;span style=&quot;color: #006600; font-style: italic;&quot;&gt;// Send the message to Drupal.&lt;/span&gt;&lt;br /&gt;
    config.&lt;span style=&quot;color: #660066;&quot;&gt;sendMessageToBackend&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;(&lt;/span&gt;message&lt;span style=&quot;color: #339933;&quot;&gt;,&lt;/span&gt; &lt;span style=&quot;color: #003366; font-weight: bold;&quot;&gt;function&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;(&lt;/span&gt;&lt;a href=&quot;http://docs.jquery.com/Events/error&quot;&gt;&lt;span style=&quot;color: #000066;&quot;&gt;error&lt;/span&gt;&lt;/a&gt;&lt;span style=&quot;color: #339933;&quot;&gt;,&lt;/span&gt; responce&lt;span style=&quot;color: #339933;&quot;&gt;,&lt;/span&gt; body&lt;span style=&quot;color: #009900;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #009900;&quot;&gt;{&lt;/span&gt;&lt;br /&gt;
      &lt;span style=&quot;color: #000066; font-weight: bold;&quot;&gt;if&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;(&lt;/span&gt;&lt;a href=&quot;http://docs.jquery.com/Events/error&quot;&gt;&lt;span style=&quot;color: #000066;&quot;&gt;error&lt;/span&gt;&lt;/a&gt;&lt;span style=&quot;color: #009900;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #009900;&quot;&gt;{&lt;/span&gt;&lt;br /&gt;
        console.&lt;span style=&quot;color: #660066;&quot;&gt;log&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #3366CC;&quot;&gt;&#039;Error sending message to backend.&#039;&lt;/span&gt;&lt;span style=&quot;color: #339933;&quot;&gt;,&lt;/span&gt; &lt;a href=&quot;http://docs.jquery.com/Events/error&quot;&gt;&lt;span style=&quot;color: #000066;&quot;&gt;error&lt;/span&gt;&lt;/a&gt;&lt;span style=&quot;color: #009900;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #339933;&quot;&gt;;&lt;/span&gt;&lt;br /&gt;
        &lt;span style=&quot;color: #000066; font-weight: bold;&quot;&gt;return&lt;/span&gt;&lt;span style=&quot;color: #339933;&quot;&gt;;&lt;/span&gt;&lt;br /&gt;
      &lt;span style=&quot;color: #009900;&quot;&gt;}&lt;/span&gt;&lt;br /&gt;
      &lt;span style=&quot;color: #006600; font-style: italic;&quot;&gt;// Drupal got it! Output the responce.&lt;/span&gt;&lt;br /&gt;
      console.&lt;span style=&quot;color: #660066;&quot;&gt;log&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #3366CC;&quot;&gt;&#039;Response from drupal: &#039;&lt;/span&gt;&lt;span style=&quot;color: #339933;&quot;&gt;,&lt;/span&gt; body&lt;span style=&quot;color: #009900;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #339933;&quot;&gt;;&lt;/span&gt;&lt;br /&gt;
    &lt;span style=&quot;color: #009900;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #339933;&quot;&gt;;&lt;/span&gt;&lt;br /&gt;
  &lt;span style=&quot;color: #009900;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;)&lt;/span&gt;&lt;br /&gt;&lt;span style=&quot;color: #009900;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #339933;&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;We grab our message from the client and send it to the Drupal backend, then upon success log Drupal&#039;s response to the console. Now our little message chain is complete!  We have a message coming from the client side to the node server upon a user action. Then node passes that message along to Drupal which records it in the watchdog.  This means that not only can we have our node server interacting back and forth with the client, but also have tremendous flexibility over how the node server can interact with Drupal.&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;</description>
 <pubDate>Mon, 29 Oct 2012 01:36:31 +0000</pubDate>
 <dc:creator>rho</dc:creator>
 <guid isPermaLink="false">162 at http://theoleschool.com</guid>
</item>
<item>
 <title>Templating the Commerce Order Completion Pane</title>
 <link>http://theoleschool.com/blog/templating-commerce-order-completion-pane</link>
 <description>&lt;div class=&quot;field field-name-body field-type-text-with-summary field-label-hidden&quot;&gt;&lt;div class=&quot;field-items&quot;&gt;&lt;div class=&quot;field-item even&quot; property=&quot;content:encoded&quot;&gt;&lt;p&gt;I recently found myself working on a fairly simple Drupal Commerce site.  There weren&#039;t a lot of tricks to it, just a few items and an &quot;express&quot; checkout.  So I fired up the &lt;a href=&quot;http://drupal.org/project/commerce_kickstart&quot;&gt;Commerce Kickstart&lt;/a&gt; profile and after a few small tweaks, had it just about right.  As we approached the theme, it became obvious that the commerce completion pane was going to take a lot of love.  The designers had given us a unique layout for how this page should appear, complete with order specific information displayed in a kaleidoscope of containers.  This was going to take some markup, and my first thought was, &quot;it sure would be nice to template this.&quot;&lt;/p&gt;&lt;!--break--&gt;
&lt;p&gt;Turns out that&#039;s a fairly simple task thanks to &lt;a href=&quot;http://api.drupalcommerce.org/api/Drupal%20Commerce/sites!all!modules!commerce!modules!checkout!commerce_checkout.api.php/function/hook_commerce_checkout_pane_info_alter/DC&quot;&gt;hook_commerce_checkout_pane_info_alter&lt;/a&gt;.  The function passes the variable &lt;span class=&quot;geshifilter&quot;&gt;&lt;code class=&quot;php geshifilter-php&quot;&gt;&lt;span style=&quot;color: #000088;&quot;&gt;$checkout_panes&lt;/span&gt;&lt;/code&gt;&lt;/span&gt; by reference which contains an array of checkout pane arrays.  This function is going to allow us to redefine the function that the checkout completion pane is looking to for output.  This will look something like:&lt;/p&gt;
&lt;div class=&quot;geshifilter&quot;&gt;&lt;div class=&quot;drupal6 geshifilter-drupal6&quot; style=&quot;font-family:monospace;&quot;&gt;&lt;span style=&quot;color: #000000; font-weight: bold;&quot;&gt;function&lt;/span&gt; my_module_commerce_checkout_pane_info_alter&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;$checkout_panes&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #66cc66;&quot;&gt;{&lt;/span&gt;&lt;br /&gt;
  &lt;span style=&quot;color: #b1b100;&quot;&gt;if&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;a href=&quot;http://www.php.net/isset&quot;&gt;&lt;span style=&quot;color: #000066;&quot;&gt;isset&lt;/span&gt;&lt;/a&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;$checkout_panes&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;checkout_completion_message&#039;&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #66cc66;&quot;&gt;{&lt;/span&gt;&lt;br /&gt;
    &lt;span style=&quot;color: #808080; font-style: italic;&quot;&gt;// forget the original include file                     &lt;/span&gt;&lt;br /&gt;
    &lt;a href=&quot;http://www.php.net/unset&quot;&gt;&lt;span style=&quot;color: #000066;&quot;&gt;unset&lt;/span&gt;&lt;/a&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;$checkout_panes&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;checkout_completion_message&#039;&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;file&#039;&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt;;&lt;br /&gt;
    &lt;span style=&quot;color: #808080; font-style: italic;&quot;&gt;// point at this module&lt;/span&gt;&lt;br /&gt;
    &lt;span style=&quot;color: #0000ff;&quot;&gt;$checkout_panes&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;checkout_completion_message&#039;&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;module&#039;&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;]&lt;/span&gt; = &lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;my_module&#039;&lt;/span&gt;;&lt;br /&gt;
    &lt;span style=&quot;color: #808080; font-style: italic;&quot;&gt;// register the new output function&lt;/span&gt;&lt;br /&gt;
    &lt;span style=&quot;color: #0000ff;&quot;&gt;$checkout_panes&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;checkout_completion_message&#039;&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;base&#039;&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;]&lt;/span&gt; = &lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;my_module_completion_message_pane&#039;&lt;/span&gt;;&lt;br /&gt;
  &lt;span style=&quot;color: #66cc66;&quot;&gt;}&lt;/span&gt;&lt;br /&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The function name we passed above will have &lt;span class=&quot;geshifilter&quot;&gt;&lt;code class=&quot;php geshifilter-php&quot;&gt;_checkout_form&lt;/code&gt;&lt;/span&gt; appended.  We will need to declare a function to satisfy this  and return our output.&lt;/p&gt;
&lt;div class=&quot;geshifilter&quot;&gt;&lt;div class=&quot;drupal6 geshifilter-drupal6&quot; style=&quot;font-family:monospace;&quot;&gt;&lt;span style=&quot;color: #000000; font-weight: bold;&quot;&gt;function&lt;/span&gt; my_module_completion_message_pane_checkout_form&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;$form&lt;/span&gt;, &lt;span style=&quot;color: #66cc66;&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;$form_state&lt;/span&gt;, &lt;span style=&quot;color: #0000ff;&quot;&gt;$checkout_pane&lt;/span&gt;, &lt;span style=&quot;color: #0000ff;&quot;&gt;$order&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #66cc66;&quot;&gt;{&lt;/span&gt;&lt;br /&gt;
  &lt;span style=&quot;color: #0000ff;&quot;&gt;$pane_form&lt;/span&gt; = &lt;a href=&quot;http://www.php.net/array&quot;&gt;&lt;span style=&quot;color: #000066;&quot;&gt;array&lt;/span&gt;&lt;/a&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt;;&lt;br /&gt;
  &lt;span style=&quot;color: #0000ff;&quot;&gt;$pane_form&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;message&#039;&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;]&lt;/span&gt; = &lt;a href=&quot;http://www.php.net/array&quot;&gt;&lt;span style=&quot;color: #000066;&quot;&gt;array&lt;/span&gt;&lt;/a&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;#markup&#039;&lt;/span&gt; =&lt;span style=&quot;color: #66cc66;&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&quot;color: #808080; font-style: italic;&quot;&gt;/*markup*/&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt;;&lt;br /&gt;
  &lt;span style=&quot;color: #b1b100;&quot;&gt;return&lt;/span&gt; &lt;span style=&quot;color: #0000ff;&quot;&gt;$pane_form&lt;/span&gt;;&lt;br /&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;From here, we&#039;re basically home free.  We simply need to replace &lt;span class=&quot;geshifilter&quot;&gt;&lt;code class=&quot;php geshifilter-php&quot;&gt;&lt;span style=&quot;color: #666666; font-style: italic;&quot;&gt;/*markup*/&lt;/span&gt;&lt;/code&gt;&lt;/span&gt; with the output we desire.  Since we are looking to template this, we will need to register a theme implementation for it.  The important thing to note is the &lt;span class=&quot;geshifilter&quot;&gt;&lt;code class=&quot;php geshifilter-php&quot;&gt;&lt;span style=&quot;color: #000088;&quot;&gt;$order&lt;/span&gt;&lt;/code&gt;&lt;/span&gt; variable passed to this function.  We&#039;ll need that order information in our template, so we pass it along while laying out our &lt;span class=&quot;geshifilter&quot;&gt;&lt;code class=&quot;php geshifilter-php&quot;&gt;hook_theme&lt;/code&gt;&lt;/span&gt; call.&lt;/p&gt;
&lt;div class=&quot;geshifilter&quot;&gt;&lt;div class=&quot;drupal6 geshifilter-drupal6&quot; style=&quot;font-family:monospace;&quot;&gt;&lt;span style=&quot;color: #000000; font-weight: bold;&quot;&gt;function&lt;/span&gt; my_module_theme&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;$existing&lt;/span&gt;, &lt;span style=&quot;color: #0000ff;&quot;&gt;$type&lt;/span&gt;, &lt;span style=&quot;color: #0000ff;&quot;&gt;$theme&lt;/span&gt;, &lt;span style=&quot;color: #0000ff;&quot;&gt;$path&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #66cc66;&quot;&gt;{&lt;/span&gt;&lt;br /&gt;
  &lt;span style=&quot;color: #b1b100;&quot;&gt;return&lt;/span&gt; &lt;a href=&quot;http://www.php.net/array&quot;&gt;&lt;span style=&quot;color: #000066;&quot;&gt;array&lt;/span&gt;&lt;/a&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;br /&gt;
    &lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;my_module_completion&#039;&lt;/span&gt; =&lt;span style=&quot;color: #66cc66;&quot;&gt;&amp;gt;&lt;/span&gt; &lt;a href=&quot;http://www.php.net/array&quot;&gt;&lt;span style=&quot;color: #000066;&quot;&gt;array&lt;/span&gt;&lt;/a&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;br /&gt;
      &lt;span style=&quot;color: #808080; font-style: italic;&quot;&gt;// the template filename, .tpl.php will be appended&lt;/span&gt;&lt;br /&gt;
      &lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;template&#039;&lt;/span&gt; =&lt;span style=&quot;color: #66cc66;&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;my_module_completion&#039;&lt;/span&gt;,&lt;br /&gt;
      &lt;span style=&quot;color: #808080; font-style: italic;&quot;&gt;// include order as a variable in the template&lt;/span&gt;&lt;br /&gt;
      &lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;variables&#039;&lt;/span&gt; =&lt;span style=&quot;color: #66cc66;&quot;&gt;&amp;gt;&lt;/span&gt; &lt;a href=&quot;http://www.php.net/array&quot;&gt;&lt;span style=&quot;color: #000066;&quot;&gt;array&lt;/span&gt;&lt;/a&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;order&#039;&lt;/span&gt; =&lt;span style=&quot;color: #66cc66;&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&quot;color: #000000; font-weight: bold;&quot;&gt;NULL&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt;,&lt;br /&gt;
    &lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt;,&lt;br /&gt;
  &lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt;;&lt;br /&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;}&lt;/span&gt; &lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Now that we have a theme implementation that is expecting an order variable, all that remains is to call it as the value for &lt;span class=&quot;geshifilter&quot;&gt;&lt;code class=&quot;php geshifilter-php&quot;&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;&#039;#markup&#039;&lt;/span&gt;&lt;/code&gt;&lt;/span&gt; in our output function above.&lt;/p&gt;
&lt;div class=&quot;geshifilter&quot;&gt;&lt;div class=&quot;drupal6 geshifilter-drupal6&quot; style=&quot;font-family:monospace;&quot;&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;$pane_form&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;message&#039;&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;]&lt;/span&gt; = &lt;a href=&quot;http://www.php.net/array&quot;&gt;&lt;span style=&quot;color: #000066;&quot;&gt;array&lt;/span&gt;&lt;/a&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;#markup&#039;&lt;/span&gt; =&lt;span style=&quot;color: #66cc66;&quot;&gt;&amp;gt;&lt;/span&gt; &lt;a href=&quot;http://api.drupal.org/api/function/theme/6&quot;&gt;&lt;span style=&quot;color: #000066;&quot;&gt;theme&lt;/span&gt;&lt;/a&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;my_module_completion&#039;&lt;/span&gt;, &lt;a href=&quot;http://www.php.net/array&quot;&gt;&lt;span style=&quot;color: #000066;&quot;&gt;array&lt;/span&gt;&lt;/a&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;order&#039;&lt;/span&gt; =&lt;span style=&quot;color: #66cc66;&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&quot;color: #0000ff;&quot;&gt;$order&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt;;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;From here simply create the &lt;span class=&quot;geshifilter&quot;&gt;&lt;code class=&quot;php geshifilter-php&quot;&gt;my_module_completion&lt;span style=&quot;color: #339933;&quot;&gt;.&lt;/span&gt;tpl&lt;span style=&quot;color: #339933;&quot;&gt;.&lt;/span&gt;php&lt;/code&gt;&lt;/span&gt; file and theme away!  The template will have our order information exposed as the php variable &lt;span class=&quot;geshifilter&quot;&gt;&lt;code class=&quot;php geshifilter-php&quot;&gt;&lt;span style=&quot;color: #000088;&quot;&gt;$order&lt;/span&gt;&lt;/code&gt;&lt;/span&gt; allowing us to output whatever order information we would like.  This is probably a good time to note, that the &lt;span class=&quot;geshifilter&quot;&gt;&lt;code class=&quot;php geshifilter-php&quot;&gt;&lt;span style=&quot;color: #000088;&quot;&gt;$order&lt;/span&gt;&lt;/code&gt;&lt;/span&gt; variable very well may not be sufficient (it wasn&#039;t for us).  It contains mostly keys to fetch other bits of data about the order.  In our actual implementation we wound up loading the line item (our implementation only allowed one), and some customer information.  This can easily be done from the output function you define in &lt;span class=&quot;geshifilter&quot;&gt;&lt;code class=&quot;php geshifilter-php&quot;&gt;hook_commerce_checkout_pane_info_alter&lt;/code&gt;&lt;/span&gt; and passed to the template exactly as we did the order variable in this example.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;I admit that this is bordering on being somewhat hackish.&lt;/em&gt;  I don&#039;t think I would take this approach if the Commerce implementation was more complex.  If that were the case a better approach may be to &lt;a href=&quot;http://api.drupalcommerce.org/api/Drupal%20Commerce/sites%21all%21modules%21commerce%21modules%21checkout%21commerce_checkout.api.php/function/hook_commerce_checkout_pane_info/DC&quot;&gt;create a custom checkout pane&lt;/a&gt;  with the output you would like, assign it to the appropriate checkout pages, and leave the poor checkout completion pane alone.  However, in the interest of time and ease in satisfying a theme requirement for a relatively small site, this method worked like a charm.  Further, I don&#039;t believe that anything has been obfuscated.  With some light commenting it should be apparent to anyone who reviews this code, exactly what is going on.  With that in mind, take this method as a handy &lt;em&gt;trick&lt;/em&gt; if you need to quickly and drastically rework how the checkout completion pane is displayed.&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;</description>
 <pubDate>Sun, 12 Aug 2012 18:25:26 +0000</pubDate>
 <dc:creator>rho</dc:creator>
 <guid isPermaLink="false">161 at http://theoleschool.com</guid>
</item>
<item>
 <title>Module Development with NodeJS Integration</title>
 <link>http://theoleschool.com/blog/module-development-nodejs-integration</link>
 <description>&lt;div class=&quot;field field-name-body field-type-text-with-summary field-label-hidden&quot;&gt;&lt;div class=&quot;field-items&quot;&gt;&lt;div class=&quot;field-item even&quot; property=&quot;content:encoded&quot;&gt;&lt;p&gt;I&#039;ve been spending some time experimenting with &lt;a href=&quot;http://nodejs.org/&quot;&gt;NodeJS&lt;/a&gt; in relation to the Drupal environment.  In many of these Node/Drupal interactions the &lt;a href=&quot;http://drupal.org/project/nodejs&quot;&gt;NodeJS Integration module&lt;/a&gt; has become a key player.  There is a very helpful pdf from &lt;a href=&quot;http://www.drupalcampnj.org/sessions/drupal-and-nodejs&quot;&gt;a talk that beejeebus gave at Drupal camp New Jersey&lt;/a&gt; that gives few great visualizations of the underlying principles of how this module works.  In essence it &quot;takes care of the plumbing,&quot;  leaving you, the developer, free to focus on how you would like to integrate. The module is easy to use, and provides a nice set of functions to quickly get rolling.  To that point I would like to give a very simple example demonstrating the use of the nodejs integration module.&lt;/p&gt;
&lt;p&gt;It&#039;s perhaps easiest to think of this integration as allowing Drupal to send messages (data) to a client via NodeJS &quot;plumbing.&quot; I feel that the simplest and most transparent example is to allow the user to control what that message is and when it is sent.  In this demonstration we build a simple form.  This form allows a user to enter a message into a text field. Then on submit, it sends that message to all connected sockets and replaces a bit of &lt;span class=&quot;geshifilter&quot;&gt;&lt;code class=&quot;php geshifilter-php&quot;&gt;&lt;span style=&quot;color: #339933;&quot;&gt;&amp;lt;&lt;/span&gt;h3&lt;span style=&quot;color: #339933;&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/span&gt; markup within the form. This is very similar to the &quot;broadcast notifications&quot; form included with the NodeJS integration module, but much simpler.&lt;/p&gt;
&lt;p&gt;To help visualize this I&#039;ve setup an install to show &lt;a href=&quot;http://demo.theoleschool.com/swap&quot;&gt;this demo in action&lt;/a&gt;.  If no one else is viewing the demo page while you are, which very likely will be the case, then I encourage you to open another session (open the page in another browser) and arrange the browser windows so you can see them both at once.  This way, when you submit in one session, you can see the text in the header change on the other. I&#039;ve also checked in &lt;a href=&quot;https://github.com/rh0/swapit_demo&quot;&gt;the code on github&lt;/a&gt; to help fill in the gaps from the snippets I provide here, and hopefully help to make sense of my yammering. So with that, lets get into a bit more detail...&lt;/p&gt;
&lt;h3 id=&quot;considerations&quot;&gt;Begin with a few considerations.&lt;/h3&gt;
&lt;p&gt;When you set out to create your module using NodeJS integration it may help to ask yourself some simple questions.&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;Who receives the message?&lt;/li&gt;
&lt;li&gt;What is the message?&lt;/li&gt;
&lt;li&gt;How is the message triggered?&lt;/li&gt;
&lt;li&gt;What will be done with the message once it is received?&lt;/li&gt;
&lt;/ul&gt;&lt;h3 id=&quot;who-receives&quot;&gt;Who receives the message?&lt;/h3&gt;
&lt;p&gt;After a user has requested a connection to socket.io, NodeJS sends this authentication token to Drupal. Drupal then sends back a list of channels the user can &quot;listen&quot; on.  To manage which channels a user is assigned to we can use &lt;span class=&quot;geshifilter&quot;&gt;&lt;code class=&quot;php geshifilter-php&quot;&gt;&lt;span style=&quot;color: #000000; font-weight: bold;&quot;&gt;function&lt;/span&gt; hook_nodejs_user_channels&lt;span style=&quot;color: #009900;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #000088;&quot;&gt;$auth_user&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/span&gt;. The &lt;span class=&quot;geshifilter&quot;&gt;&lt;code class=&quot;php geshifilter-php&quot;&gt;&lt;span style=&quot;color: #000088;&quot;&gt;$auth_user&lt;/span&gt;&lt;/code&gt;&lt;/span&gt; parameter is the user that is being authenticated. Any checks you might need to perform on the user to determine if they should be assigned a channel can be done here.&lt;/p&gt;&lt;p&gt;
&lt;/p&gt;&lt;p&gt;In our example we&#039;re keeping this really simple.  We want to send the message to all users so we give everyone who authenticates the &#039;swapit_demo&#039; channel.&lt;/p&gt;
&lt;div class=&quot;geshifilter&quot;&gt;&lt;div class=&quot;php geshifilter-php&quot; style=&quot;font-family:monospace;&quot;&gt;&lt;span style=&quot;color: #000000; font-weight: bold;&quot;&gt;function&lt;/span&gt; swapit_demo_nodejs_user_channels&lt;span style=&quot;color: #009900;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #000088;&quot;&gt;$auth_user&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #009900;&quot;&gt;{&lt;/span&gt;&lt;br /&gt;
  &lt;span style=&quot;color: #000088;&quot;&gt;$channels&lt;/span&gt; &lt;span style=&quot;color: #339933;&quot;&gt;=&lt;/span&gt; &lt;a href=&quot;http://www.php.net/array&quot;&gt;&lt;span style=&quot;color: #990000;&quot;&gt;array&lt;/span&gt;&lt;/a&gt;&lt;span style=&quot;color: #009900;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;&#039;swapit_demo&#039;&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #339933;&quot;&gt;;&lt;/span&gt;&lt;br /&gt;
  &lt;span style=&quot;color: #b1b100;&quot;&gt;return&lt;/span&gt; &lt;span style=&quot;color: #000088;&quot;&gt;$channels&lt;/span&gt;&lt;span style=&quot;color: #339933;&quot;&gt;;&lt;/span&gt;&lt;br /&gt;&lt;span style=&quot;color: #009900;&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h3 id=&quot;what-sends&quot;&gt;What is the message and how is it triggered?&lt;/h3&gt;
&lt;p&gt;The message itself is a small object that contains the data it is intended to send, along with some information on how/where to send it. The trigger could really be anything and will likely be pretty obvious based on your use case.  In our example module, we&#039;re providing the users a form to allow them to write the message that will then be sent on submit.  So all of the magic happens in our submit function.&lt;/p&gt;
&lt;div class=&quot;geshifilter&quot;&gt;&lt;div class=&quot;php geshifilter-php&quot; style=&quot;font-family:monospace;&quot;&gt;&lt;span style=&quot;color: #000000; font-weight: bold;&quot;&gt;function&lt;/span&gt; swapit_demo_swap_submit&lt;span style=&quot;color: #009900;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #000088;&quot;&gt;$form&lt;/span&gt;&lt;span style=&quot;color: #339933;&quot;&gt;,&lt;/span&gt; &lt;span style=&quot;color: #339933;&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: #000088;&quot;&gt;$form_state&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #009900;&quot;&gt;{&lt;/span&gt;&lt;br /&gt;
  &lt;span style=&quot;color: #000088;&quot;&gt;$user_msg&lt;/span&gt; &lt;span style=&quot;color: #339933;&quot;&gt;=&lt;/span&gt; check_plain&lt;span style=&quot;color: #009900;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #000088;&quot;&gt;$form_state&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;&#039;values&#039;&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;&#039;user_message&#039;&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #339933;&quot;&gt;;&lt;/span&gt;&lt;br /&gt;
  &lt;span style=&quot;color: #666666; font-style: italic;&quot;&gt;//just doing a quick variable set to store the string.&lt;/span&gt;&lt;br /&gt;
  variable_set&lt;span style=&quot;color: #009900;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;&#039;demo_message&#039;&lt;/span&gt;&lt;span style=&quot;color: #339933;&quot;&gt;,&lt;/span&gt; &lt;span style=&quot;color: #000088;&quot;&gt;$user_msg&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #339933;&quot;&gt;;&lt;/span&gt;&lt;br /&gt;
  &lt;span style=&quot;color: #666666; font-style: italic;&quot;&gt;//broadcasting the string to our listening javascript in waiting&lt;/span&gt;&lt;br /&gt;
  &lt;span style=&quot;color: #000088;&quot;&gt;$message&lt;/span&gt; &lt;span style=&quot;color: #339933;&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color: #000000; font-weight: bold;&quot;&gt;new&lt;/span&gt; stdClass&lt;span style=&quot;color: #009900;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #339933;&quot;&gt;;&lt;/span&gt;&lt;br /&gt;
  &lt;span style=&quot;color: #000088;&quot;&gt;$message&lt;/span&gt;&lt;span style=&quot;color: #339933;&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #004000;&quot;&gt;channel&lt;/span&gt; &lt;span style=&quot;color: #339933;&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color: #0000ff;&quot;&gt;&#039;swapit_demo&#039;&lt;/span&gt;&lt;span style=&quot;color: #339933;&quot;&gt;;&lt;/span&gt;&lt;br /&gt;
  &lt;span style=&quot;color: #000088;&quot;&gt;$message&lt;/span&gt;&lt;span style=&quot;color: #339933;&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #004000;&quot;&gt;broadcast&lt;/span&gt; &lt;span style=&quot;color: #339933;&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color: #009900; font-weight: bold;&quot;&gt;TRUE&lt;/span&gt;&lt;span style=&quot;color: #339933;&quot;&gt;;&lt;/span&gt;&lt;br /&gt;
  &lt;span style=&quot;color: #000088;&quot;&gt;$message&lt;/span&gt;&lt;span style=&quot;color: #339933;&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #004000;&quot;&gt;data&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;&#039;body&#039;&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;]&lt;/span&gt; &lt;span style=&quot;color: #339933;&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color: #000088;&quot;&gt;$user_msg&lt;/span&gt;&lt;span style=&quot;color: #339933;&quot;&gt;;&lt;/span&gt;&lt;br /&gt;
  &lt;span style=&quot;color: #000088;&quot;&gt;$message&lt;/span&gt;&lt;span style=&quot;color: #339933;&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #004000;&quot;&gt;callback&lt;/span&gt; &lt;span style=&quot;color: #339933;&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color: #0000ff;&quot;&gt;&#039;swapIt&#039;&lt;/span&gt;&lt;span style=&quot;color: #339933;&quot;&gt;;&lt;/span&gt;&lt;br /&gt;
  nodejs_send_message&lt;span style=&quot;color: #009900;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #000088;&quot;&gt;$message&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #339933;&quot;&gt;;&lt;/span&gt;&lt;br /&gt;&lt;span style=&quot;color: #009900;&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Here we are grabbing the form data from our textfield, and inserting it into a message object.  &lt;em&gt;Note how we are setting the channel to the one we set back in &lt;span class=&quot;geshifilter&quot;&gt;&lt;code class=&quot;php geshifilter-php&quot;&gt;hook_nodejs_user_channels&lt;/code&gt;&lt;/span&gt;.&lt;/em&gt;  Passing this object to &lt;span class=&quot;geshifilter&quot;&gt;&lt;code class=&quot;php geshifilter-php&quot;&gt;node_send_message&lt;/code&gt;&lt;/span&gt; will get NodeJS to broadcast to all connected sockets having the &#039;swapit_demo&#039; channel.  The &lt;span class=&quot;geshifilter&quot;&gt;&lt;code class=&quot;php geshifilter-php&quot;&gt;&lt;span style=&quot;color: #000088;&quot;&gt;$message&lt;/span&gt;&lt;span style=&quot;color: #339933;&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #004000;&quot;&gt;data&lt;/span&gt;&lt;/code&gt;&lt;/span&gt; array contains our user submitted message.  The &lt;span class=&quot;geshifilter&quot;&gt;&lt;code class=&quot;php geshifilter-php&quot;&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;&#039;body&#039;&lt;/span&gt;&lt;/code&gt;&lt;/span&gt; key is arbitrary.&lt;/p&gt;&lt;p&gt;
&lt;/p&gt;&lt;h3 id=&quot;what-will-be-done&quot;&gt;What will be done with the message?&lt;/h3&gt;
&lt;p&gt;Now that we have a message being broadcast we need to have a bit of javascript on the client side that will receive and do something with it.  In our case, we simply want to replace the text in our given HTML element.&lt;/p&gt;
&lt;div class=&quot;geshifilter&quot;&gt;&lt;div class=&quot;jquery geshifilter-jquery&quot; style=&quot;font-family:monospace;&quot;&gt;Drupal.&lt;span style=&quot;color: #660066;&quot;&gt;Nodejs&lt;/span&gt;.&lt;span style=&quot;color: #660066;&quot;&gt;callbacks&lt;/span&gt;.&lt;span style=&quot;color: #660066;&quot;&gt;swapIt&lt;/span&gt; &lt;span style=&quot;color: #339933;&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color: #009900;&quot;&gt;{&lt;/span&gt;&lt;br /&gt;
  &lt;span style=&quot;color: #006600; font-style: italic;&quot;&gt;//grab the message and inject into the header&lt;/span&gt;&lt;br /&gt;
  callback&lt;span style=&quot;color: #339933;&quot;&gt;:&lt;/span&gt; &lt;span style=&quot;color: #003366; font-weight: bold;&quot;&gt;function&lt;/span&gt; &lt;span style=&quot;color: #009900;&quot;&gt;(&lt;/span&gt;message&lt;span style=&quot;color: #009900;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #009900;&quot;&gt;{&lt;/span&gt;&lt;br /&gt;
    &lt;span style=&quot;color: #000066; font-weight: bold;&quot;&gt;if&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;(&lt;/span&gt;message.&lt;span style=&quot;color: #660066;&quot;&gt;channel&lt;/span&gt; &lt;span style=&quot;color: #339933;&quot;&gt;==&lt;/span&gt; &lt;span style=&quot;color: #3366CC;&quot;&gt;&#039;swapit_demo&#039;&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #009900;&quot;&gt;{&lt;/span&gt;&lt;br /&gt;
      &lt;span style=&quot;color: #000066;&quot;&gt;$&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #3366CC;&quot;&gt;&#039;form #nodejs-selector&#039;&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;)&lt;/span&gt;.&lt;a href=&quot;http://docs.jquery.com/Attributes/html&quot;&gt;&lt;span style=&quot;color: #000066;&quot;&gt;html&lt;/span&gt;&lt;/a&gt;&lt;span style=&quot;color: #009900;&quot;&gt;(&lt;/span&gt;message.&lt;a href=&quot;http://docs.jquery.com/Core/data&quot;&gt;&lt;span style=&quot;color: #000066;&quot;&gt;data&lt;/span&gt;&lt;/a&gt;.&lt;span style=&quot;color: #660066;&quot;&gt;body&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #339933;&quot;&gt;;&lt;/span&gt;&lt;br /&gt;
    &lt;span style=&quot;color: #009900;&quot;&gt;}&lt;/span&gt;&lt;br /&gt;
  &lt;span style=&quot;color: #009900;&quot;&gt;}&lt;/span&gt;&lt;br /&gt;&lt;span style=&quot;color: #009900;&quot;&gt;}&lt;/span&gt;&lt;span style=&quot;color: #339933;&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;We first define a callback function to receive the message.  Note how the callback name is passed to the message object in the submit function in the previous snippet.  Our function now verifies the channel on the message object, and uses the message data to replace the text in the &lt;span class=&quot;geshifilter&quot;&gt;&lt;code class=&quot;php geshifilter-php&quot;&gt;&lt;span style=&quot;color: #666666; font-style: italic;&quot;&gt;#nodejs-selector&lt;/span&gt;&lt;/code&gt;&lt;/span&gt; element. Notice how &lt;span class=&quot;geshifilter&quot;&gt;&lt;code class=&quot;php geshifilter-php&quot;&gt;&lt;span style=&quot;color: #000088;&quot;&gt;$message&lt;/span&gt;&lt;span style=&quot;color: #339933;&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #004000;&quot;&gt;data&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;&#039;body&#039;&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/span&gt; has translated to &lt;span class=&quot;geshifilter&quot;&gt;&lt;code class=&quot;jquery geshifilter-jquery&quot;&gt;message.&lt;a href=&quot;http://docs.jquery.com/Core/data&quot;&gt;&lt;span style=&quot;color: #000066;&quot;&gt;data&lt;/span&gt;&lt;/a&gt;.&lt;span style=&quot;color: #660066;&quot;&gt;body&lt;/span&gt;&lt;/code&gt;&lt;/span&gt; in the javascript.  All that remains is to tell the nodejs integration module about the file containing our client side javascript.&lt;/p&gt;
&lt;div class=&quot;geshifilter&quot;&gt;&lt;div class=&quot;php geshifilter-php&quot; style=&quot;font-family:monospace;&quot;&gt;&lt;span style=&quot;color: #000000; font-weight: bold;&quot;&gt;function&lt;/span&gt; swapit_demo_nodejs_handlers_info&lt;span style=&quot;color: #009900;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #009900;&quot;&gt;{&lt;/span&gt;&lt;br /&gt;
  &lt;span style=&quot;color: #b1b100;&quot;&gt;return&lt;/span&gt; &lt;a href=&quot;http://www.php.net/array&quot;&gt;&lt;span style=&quot;color: #990000;&quot;&gt;array&lt;/span&gt;&lt;/a&gt;&lt;span style=&quot;color: #009900;&quot;&gt;(&lt;/span&gt;&lt;br /&gt;
    drupal_get_path&lt;span style=&quot;color: #009900;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;&#039;module&#039;&lt;/span&gt;&lt;span style=&quot;color: #339933;&quot;&gt;,&lt;/span&gt; &lt;span style=&quot;color: #0000ff;&quot;&gt;&#039;swapit_demo&#039;&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #339933;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;&#039;/swapit_demo.client.js&#039;&lt;/span&gt;&lt;span style=&quot;color: #339933;&quot;&gt;,&lt;/span&gt;&lt;br /&gt;
  &lt;span style=&quot;color: #009900;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #339933;&quot;&gt;;&lt;/span&gt;&lt;br /&gt;&lt;span style=&quot;color: #009900;&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;That about sums it up in the simplest way I knew how.  I welcome any questions, and would love to hear of others experience with this useful module&lt;/p&gt;
&lt;h3&gt;Resources:&lt;/h3&gt;
&lt;ul&gt;&lt;li&gt;NodeJS Integration module ( &lt;a href=&quot;http://drupal.org/project/nodejs&quot;&gt;http://drupal.org/project/nodejs&lt;/a&gt; )&lt;/li&gt;
&lt;li&gt;beejeebus&#039; talk at Drupalcamp NJ ( &lt;a href=&quot;http://www.drupalcampnj.org/sessions/drupal-and-nodejs&quot;&gt;http://www.drupalcampnj.org/sessions/drupal-and-nodejs&lt;/a&gt; )&lt;/li&gt;
&lt;li&gt;Demonstration of this module ( &lt;a href=&quot;http://demo.theoleschool.com/swap&quot;&gt;http://demo.theoleschool.com/swap&lt;/a&gt; )&lt;/li&gt;
&lt;li&gt;This code on github ( &lt;a href=&quot;https://github.com/rh0/swapit_demo&quot;&gt;https://github.com/rh0/swapit_demo&lt;/a&gt; )&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;</description>
 <pubDate>Sat, 21 Apr 2012 15:49:34 +0000</pubDate>
 <dc:creator>rho</dc:creator>
 <guid isPermaLink="false">160 at http://theoleschool.com</guid>
</item>
<item>
 <title>Using hook_views_alter to Add a GROUP BY Statement</title>
 <link>http://theoleschool.com/blog/using-hookviewsalter-add-group-statement</link>
 <description>&lt;div class=&quot;field field-name-body field-type-text-with-summary field-label-hidden&quot;&gt;&lt;div class=&quot;field-items&quot;&gt;&lt;div class=&quot;field-item even&quot; property=&quot;content:encoded&quot;&gt;&lt;p&gt;&lt;em&gt;I should note this post deals with Views 2.x on Drupal 6.x&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;When Views doesn&#039;t quite spit out the query we are looking for we can turn to &lt;span class=&quot;geshifilter&quot;&gt;&lt;code class=&quot;php geshifilter-php&quot;&gt;hook_views_query_alter&lt;span style=&quot;color: #009900;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #339933;&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: #000088;&quot;&gt;$view&lt;/span&gt;&lt;span style=&quot;color: #339933;&quot;&gt;,&lt;/span&gt; &lt;span style=&quot;color: #339933;&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: #000088;&quot;&gt;$query&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/span&gt; to nudge it in the right direction.  This is by no means news, and there are many a blog post detailing various ways to alter the query using this function.  However, recently, I ran into an odd issue when attempting to add a &lt;span class=&quot;geshifilter&quot;&gt;&lt;code class=&quot;sql geshifilter-sql&quot;&gt;&lt;span style=&quot;color: #993333; font-weight: bold;&quot;&gt;GROUP&lt;/span&gt; &lt;span style=&quot;color: #993333; font-weight: bold;&quot;&gt;BY&lt;/span&gt;&lt;/code&gt;&lt;/span&gt; statement.&lt;/p&gt;
&lt;p&gt;The &lt;a href=&quot;http://drupal.org/node/385158&quot;&gt;issue&lt;/a&gt; can be observed when attempting to use the &lt;a href=&quot;http://views.doc.logrus.com/classviews__query.html#089b7eab81ec9cb4b24aa489ff4ac448&quot;&gt;&lt;span class=&quot;geshifilter&quot;&gt;&lt;code class=&quot;php geshifilter-php&quot;&gt;add_groupby&lt;/code&gt;&lt;/span&gt;  function&lt;/a&gt; to a field in the query.  As an example, say we have a node view with a few fields (node id, node title, and user id).  This will give a simple query:&lt;/p&gt;
&lt;div class=&quot;geshifilter&quot;&gt;&lt;div class=&quot;sql geshifilter-sql&quot; style=&quot;font-family:monospace;&quot;&gt;&lt;span style=&quot;color: #993333; font-weight: bold;&quot;&gt;SELECT&lt;/span&gt; node&lt;span style=&quot;color: #66cc66;&quot;&gt;.&lt;/span&gt;nid &lt;span style=&quot;color: #993333; font-weight: bold;&quot;&gt;AS&lt;/span&gt; nid&lt;span style=&quot;color: #66cc66;&quot;&gt;,&lt;/span&gt; &lt;br /&gt;
       node&lt;span style=&quot;color: #66cc66;&quot;&gt;.&lt;/span&gt;title &lt;span style=&quot;color: #993333; font-weight: bold;&quot;&gt;AS&lt;/span&gt; node_title&lt;span style=&quot;color: #66cc66;&quot;&gt;,&lt;/span&gt; &lt;br /&gt;
       users&lt;span style=&quot;color: #66cc66;&quot;&gt;.&lt;/span&gt;uid &lt;span style=&quot;color: #993333; font-weight: bold;&quot;&gt;AS&lt;/span&gt; users_uid &lt;br /&gt;&lt;span style=&quot;color: #993333; font-weight: bold;&quot;&gt;FROM&lt;/span&gt; node node  &lt;br /&gt;&lt;span style=&quot;color: #993333; font-weight: bold;&quot;&gt;INNER&lt;/span&gt; &lt;span style=&quot;color: #993333; font-weight: bold;&quot;&gt;JOIN&lt;/span&gt; users users &lt;span style=&quot;color: #993333; font-weight: bold;&quot;&gt;ON&lt;/span&gt; node&lt;span style=&quot;color: #66cc66;&quot;&gt;.&lt;/span&gt;uid &lt;span style=&quot;color: #66cc66;&quot;&gt;=&lt;/span&gt; users&lt;span style=&quot;color: #66cc66;&quot;&gt;.&lt;/span&gt;uid&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Now, say we want to do something silly and get this query to group by user id.  A node view does not allow for this, so we turn to &lt;span class=&quot;geshifilter&quot;&gt;&lt;code class=&quot;php geshifilter-php&quot;&gt;hook_views_query_alter&lt;/code&gt;&lt;/span&gt;.&lt;/p&gt;
&lt;div class=&quot;geshifilter&quot;&gt;&lt;div class=&quot;drupal6 geshifilter-drupal6&quot; style=&quot;font-family:monospace;&quot;&gt;&lt;span style=&quot;color: #000000; font-weight: bold;&quot;&gt;function&lt;/span&gt; my_module_views_query_alter&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;$view&lt;/span&gt;, &lt;span style=&quot;color: #66cc66;&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;$query&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #66cc66;&quot;&gt;{&lt;/span&gt;&lt;br /&gt;
  &lt;span style=&quot;color: #b1b100;&quot;&gt;switch&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;$view&lt;/span&gt;-&lt;span style=&quot;color: #66cc66;&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #006600;&quot;&gt;name&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #66cc66;&quot;&gt;{&lt;/span&gt;&lt;br /&gt;
    &lt;span style=&quot;color: #b1b100;&quot;&gt;case&lt;/span&gt; &lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;my_view_name&#039;&lt;/span&gt;:&lt;br /&gt;
      &lt;span style=&quot;color: #808080; font-style: italic;&quot;&gt;//add the group by  on the user id field &lt;/span&gt;&lt;br /&gt;
      &lt;span style=&quot;color: #0000ff;&quot;&gt;$query&lt;/span&gt;-&lt;span style=&quot;color: #66cc66;&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #006600;&quot;&gt;add_groupby&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;users_uid&#039;&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt;;&lt;br /&gt;
      &lt;span style=&quot;color: #b1b100;&quot;&gt;break&lt;/span&gt;;&lt;br /&gt;
  &lt;span style=&quot;color: #66cc66;&quot;&gt;}&lt;/span&gt;&lt;br /&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;We expect to see a nice &lt;span class=&quot;geshifilter&quot;&gt;&lt;code class=&quot;sql geshifilter-sql&quot;&gt;&lt;span style=&quot;color: #993333; font-weight: bold;&quot;&gt;GROUP&lt;/span&gt; &lt;span style=&quot;color: #993333; font-weight: bold;&quot;&gt;BY&lt;/span&gt; users_uid&lt;/code&gt;&lt;/span&gt; tacked on to the end of our query, but instead there is a disturbing  &lt;span class=&quot;geshifilter&quot;&gt;&lt;code class=&quot;sql geshifilter-sql&quot;&gt;&lt;span style=&quot;color: #993333; font-weight: bold;&quot;&gt;GROUP&lt;/span&gt; &lt;span style=&quot;color: #993333; font-weight: bold;&quot;&gt;BY&lt;/span&gt; nid&lt;span style=&quot;color: #66cc66;&quot;&gt;,&lt;/span&gt; node_title&lt;span style=&quot;color: #66cc66;&quot;&gt;,&lt;/span&gt; users_uid&lt;/code&gt;&lt;/span&gt;.  What gives?  Merlinofchaos &lt;a href=&quot;http://drupal.org/node/385158#comment-1296924&quot;&gt;clarifies&lt;/a&gt; for us:&lt;/p&gt;
&lt;p&gt;&lt;em&gt;&quot;When using GROUP BY items that appear in the SELECT must either use aggregate functions OR appear in the GROUP BY. This is enforced by postgres, therefore Views must enforce this.&quot;&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;It is good that Views is looking out for the rules of postgres; it&#039;s what helps make it the powerful and flexible tool it is.  In this application though, I am not worried about postgres and simply want to alter a single Views query on an sql database.  I know that I can pass an &#039;aggregate&#039; flag to the fields in the query object to denote that they use an aggregate function, even if they do not.  Worth a try...&lt;/p&gt;
&lt;div class=&quot;geshifilter&quot;&gt;&lt;div class=&quot;drupal6 geshifilter-drupal6&quot; style=&quot;font-family:monospace;&quot;&gt;&lt;span style=&quot;color: #000000; font-weight: bold;&quot;&gt;function&lt;/span&gt; dsic_judging_views_query_alter&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;$view&lt;/span&gt;, &lt;span style=&quot;color: #66cc66;&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;$query&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #66cc66;&quot;&gt;{&lt;/span&gt;&lt;br /&gt;
  &lt;span style=&quot;color: #b1b100;&quot;&gt;switch&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;$view&lt;/span&gt;-&lt;span style=&quot;color: #66cc66;&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #006600;&quot;&gt;name&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #66cc66;&quot;&gt;{&lt;/span&gt;&lt;br /&gt;
    &lt;span style=&quot;color: #b1b100;&quot;&gt;case&lt;/span&gt; &lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;dsic_judge_incomplete&#039;&lt;/span&gt;:&lt;br /&gt;
      &lt;span style=&quot;color: #808080; font-style: italic;&quot;&gt;//loop through the fields and add the aggregate indicator&lt;/span&gt;&lt;br /&gt;
      &lt;span style=&quot;color: #b1b100;&quot;&gt;foreach&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;$query&lt;/span&gt;-&lt;span style=&quot;color: #66cc66;&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #006600;&quot;&gt;fields&lt;/span&gt; &lt;span style=&quot;color: #b1b100;&quot;&gt;as&lt;/span&gt; &lt;span style=&quot;color: #0000ff;&quot;&gt;$key&lt;/span&gt; =&lt;span style=&quot;color: #66cc66;&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&quot;color: #0000ff;&quot;&gt;$field&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #66cc66;&quot;&gt;{&lt;/span&gt;&lt;br /&gt;
        &lt;span style=&quot;color: #0000ff;&quot;&gt;$query&lt;/span&gt;-&lt;span style=&quot;color: #66cc66;&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #006600;&quot;&gt;fields&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;$key&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;aggregate&#039;&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;]&lt;/span&gt; = &lt;span style=&quot;color: #000000; font-weight: bold;&quot;&gt;TRUE&lt;/span&gt;;&lt;br /&gt;
      &lt;span style=&quot;color: #66cc66;&quot;&gt;}&lt;/span&gt;&lt;br /&gt;
      &lt;span style=&quot;color: #0000ff;&quot;&gt;$query&lt;/span&gt;-&lt;span style=&quot;color: #66cc66;&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #006600;&quot;&gt;add_groupby&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;users_uid&#039;&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt;;&lt;br /&gt;
      &lt;span style=&quot;color: #b1b100;&quot;&gt;break&lt;/span&gt;;&lt;br /&gt;
  &lt;span style=&quot;color: #66cc66;&quot;&gt;}&lt;/span&gt;&lt;br /&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Turns out this works!  Jumping back to our view we see the query we are after:&lt;/p&gt;
&lt;div class=&quot;geshifilter&quot;&gt;&lt;div class=&quot;sql geshifilter-sql&quot; style=&quot;font-family:monospace;&quot;&gt;&lt;span style=&quot;color: #993333; font-weight: bold;&quot;&gt;SELECT&lt;/span&gt; node&lt;span style=&quot;color: #66cc66;&quot;&gt;.&lt;/span&gt;nid &lt;span style=&quot;color: #993333; font-weight: bold;&quot;&gt;AS&lt;/span&gt; nid&lt;span style=&quot;color: #66cc66;&quot;&gt;,&lt;/span&gt; &lt;br /&gt;
       node&lt;span style=&quot;color: #66cc66;&quot;&gt;.&lt;/span&gt;title &lt;span style=&quot;color: #993333; font-weight: bold;&quot;&gt;AS&lt;/span&gt; node_title&lt;span style=&quot;color: #66cc66;&quot;&gt;,&lt;/span&gt; &lt;br /&gt;
       users&lt;span style=&quot;color: #66cc66;&quot;&gt;.&lt;/span&gt;uid &lt;span style=&quot;color: #993333; font-weight: bold;&quot;&gt;AS&lt;/span&gt; users_uid &lt;br /&gt;&lt;span style=&quot;color: #993333; font-weight: bold;&quot;&gt;FROM&lt;/span&gt; node node  &lt;br /&gt;&lt;span style=&quot;color: #993333; font-weight: bold;&quot;&gt;INNER&lt;/span&gt; &lt;span style=&quot;color: #993333; font-weight: bold;&quot;&gt;JOIN&lt;/span&gt; users users &lt;span style=&quot;color: #993333; font-weight: bold;&quot;&gt;ON&lt;/span&gt; node&lt;span style=&quot;color: #66cc66;&quot;&gt;.&lt;/span&gt;uid &lt;span style=&quot;color: #66cc66;&quot;&gt;=&lt;/span&gt; users&lt;span style=&quot;color: #66cc66;&quot;&gt;.&lt;/span&gt;uid&lt;br /&gt;&lt;span style=&quot;color: #993333; font-weight: bold;&quot;&gt;GROUP&lt;/span&gt; &lt;span style=&quot;color: #993333; font-weight: bold;&quot;&gt;BY&lt;/span&gt; users_uid&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;If it looks like a hack, and quacks like a hack, then it&#039;s probably a... well ya know.  However, I don&#039;t have big qualms with implementing this.  Views behavior is in place to accommodate a database that, in this instance, is not being used.  Further, I am already using a hook function to modify a view beyond what that view is capable of spitting out on its own.  Lastly, I am able to accomplish this without modifying Views core.  All of that adds up to a valid use case and helps me to sleep at night.&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;</description>
 <pubDate>Mon, 12 Mar 2012 15:09:21 +0000</pubDate>
 <dc:creator>rho</dc:creator>
 <guid isPermaLink="false">159 at http://theoleschool.com</guid>
</item>
<item>
 <title>Viewing Users Who Have Not Submitted a Webform</title>
 <link>http://theoleschool.com/blog/viewing-users-who-have-not-submitted-webform</link>
 <description>&lt;div class=&quot;field field-name-body field-type-text-with-summary field-label-hidden&quot;&gt;&lt;div class=&quot;field-items&quot;&gt;&lt;div class=&quot;field-item even&quot; property=&quot;content:encoded&quot;&gt;&lt;p&gt;On a recent Drupal 6 site, I received a request to build a view displaying a list of users who had not submitted a specific webform.  &lt;a href=&quot;http://drupal.org/project/webform&amp;quot;&quot;&gt;Webform&lt;/a&gt; of course, has some very nice reporting as well as decent views integration for submissions.  However, to view users that have yet to make a submission takes some creative views argument handling.&lt;/p&gt;
&lt;p&gt;I began by building a basic user view.  I then set the style and fields to my liking, and filtered on the specific role I was looking for.  So now we have views pulling a list of users that we wish to check against.  To find out who has not submitted the webform, we first have to take a look at who has.&lt;/p&gt; 
&lt;div class=&quot;geshifilter&quot;&gt;&lt;div class=&quot;drupal6 geshifilter-drupal6&quot; style=&quot;font-family:monospace;&quot;&gt;webform_get_submissions&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;$filters&lt;/span&gt; = &lt;a href=&quot;http://www.php.net/array&quot;&gt;&lt;span style=&quot;color: #000066;&quot;&gt;array&lt;/span&gt;&lt;/a&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt;, &lt;span style=&quot;color: #0000ff;&quot;&gt;$header&lt;/span&gt; = &lt;span style=&quot;color: #000000; font-weight: bold;&quot;&gt;NULL&lt;/span&gt;, &lt;span style=&quot;color: #0000ff;&quot;&gt;$pager_count&lt;/span&gt; = &lt;span style=&quot;color: #cc66cc;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt;;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Webform has the above function in the &lt;span class=&quot;geshifilter&quot;&gt;&lt;code class=&quot;php geshifilter-php&quot;&gt;webform&lt;span style=&quot;color: #339933;&quot;&gt;.&lt;/span&gt;submission&lt;span style=&quot;color: #339933;&quot;&gt;.&lt;/span&gt;inc&lt;/code&gt;&lt;/span&gt; file that does just this.  You can pass a node id to &lt;span class=&quot;geshifilter&quot;&gt;&lt;code class=&quot;php geshifilter-php&quot;&gt;&lt;span style=&quot;color: #000088;&quot;&gt;$filters&lt;/span&gt;&lt;/code&gt;&lt;/span&gt; and the function will return a nice array of submission objects, detailing who has submitted the form.  We can then add an argument of type &lt;em&gt;&quot;User: UID&quot;&lt;/em&gt; to our view, select &lt;em&gt;&quot;Provide default argument&quot;&lt;/em&gt; below &quot;Action to take if argument is not present,&quot; and select &lt;em&gt;&quot;PHP Code&quot;&lt;/em&gt; under &quot;Default argument type.&quot;  Here we can provide a code snippet to return a list of User ids of users that have submitted the form.
&lt;/p&gt;&lt;div class=&quot;geshifilter&quot;&gt;&lt;div class=&quot;drupal6 geshifilter-drupal6&quot; style=&quot;font-family:monospace;&quot;&gt;&lt;a href=&quot;http://api.drupal.org/api/function/module_load_include/6&quot;&gt;&lt;span style=&quot;color: #000066;&quot;&gt;module_load_include&lt;/span&gt;&lt;/a&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;inc&#039;&lt;/span&gt;, &lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;webform&#039;&lt;/span&gt;, &lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;includes/webform.submissions&#039;&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt;;&lt;br /&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;$submission_array&lt;/span&gt; = webform_get_submissions&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #808080; font-style: italic;&quot;&gt;/*node id of webform we are checking for*/&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt;;&lt;br /&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;$uids&lt;/span&gt; = &lt;a href=&quot;http://www.php.net/array&quot;&gt;&lt;span style=&quot;color: #000066;&quot;&gt;array&lt;/span&gt;&lt;/a&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt;;&lt;br /&gt;&lt;span style=&quot;color: #b1b100;&quot;&gt;foreach&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;$submission_array&lt;/span&gt; &lt;span style=&quot;color: #b1b100;&quot;&gt;as&lt;/span&gt; &lt;span style=&quot;color: #0000ff;&quot;&gt;$submission&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #66cc66;&quot;&gt;{&lt;/span&gt;&lt;br /&gt;
  &lt;span style=&quot;color: #0000ff;&quot;&gt;$uids&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;]&lt;/span&gt; = &lt;span style=&quot;color: #0000ff;&quot;&gt;$submission&lt;/span&gt;-&lt;span style=&quot;color: #66cc66;&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #006600;&quot;&gt;uid&lt;/span&gt;;&lt;br /&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;}&lt;/span&gt;&lt;br /&gt;&lt;span style=&quot;color: #b1b100;&quot;&gt;return&lt;/span&gt; &lt;a href=&quot;http://www.php.net/implode&quot;&gt;&lt;span style=&quot;color: #000066;&quot;&gt;implode&lt;/span&gt;&lt;/a&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;,&#039;&lt;/span&gt;, &lt;span style=&quot;color: #0000ff;&quot;&gt;$uids&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt;;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This will gives us a comma separated string of user ids.  The default &quot;Validator options&quot; are fine but &lt;strong&gt;be sure&lt;/strong&gt; to check &lt;em&gt;&quot;Allow multiple terms per argument&quot;&lt;/em&gt; and &lt;em&gt;&quot;Exclude the argument.&quot;&lt;/em&gt;  After updating, your view now filters down to users that have not submitted the webform! To double check that this is happening, you can look at the query below the preview.  Near the end of the query in the &lt;span class=&quot;geshifilter&quot;&gt;&lt;code class=&quot;sql geshifilter-sql&quot;&gt;&lt;span style=&quot;color: #993333; font-weight: bold;&quot;&gt;WHERE&lt;/span&gt;&lt;/code&gt;&lt;/span&gt; clause, you should see something like &lt;span class=&quot;geshifilter&quot;&gt;&lt;code class=&quot;sql geshifilter-sql&quot;&gt;users&lt;span style=&quot;color: #66cc66;&quot;&gt;.&lt;/span&gt;uid &lt;span style=&quot;color: #993333; font-weight: bold;&quot;&gt;NOT&lt;/span&gt; &lt;span style=&quot;color: #993333; font-weight: bold;&quot;&gt;IN&lt;/span&gt; &lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #cc66cc;&quot;&gt;110&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;,&lt;/span&gt; &lt;span style=&quot;color: #cc66cc;&quot;&gt;13028&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;,&lt;/span&gt; &lt;span style=&quot;color: #cc66cc;&quot;&gt;210&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;,&lt;/span&gt; &lt;span style=&quot;color: #cc66cc;&quot;&gt;107&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;,&lt;/span&gt; &lt;span style=&quot;color: #cc66cc;&quot;&gt;35329&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;,&lt;/span&gt; &lt;span style=&quot;color: #cc66cc;&quot;&gt;35330&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;,&lt;/span&gt; &lt;span style=&quot;color: #cc66cc;&quot;&gt;35331&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/span&gt;. The list of numbers are the user ids that are being filtered.  If no one has submitted the form, then this of course will be empty.&lt;/p&gt;
&lt;p&gt;Now I admit, this is kinda gross. I shudder any time I include php in configuration. It is, however, a very straight forward way to get the results requested while staying in views, therefore leaving the output in the hands of a site builder/administrator.  There may be some clever ways to achieve the same thing using something like &lt;a href=&quot;http://drupal.org/project/webform_report&quot;&gt;Webform Report&lt;/a&gt;, or even a different views configuration, but nothing jumped out at me.  However, if you have solved this in a different way I would love to hear about it.&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;</description>
 <pubDate>Sun, 04 Mar 2012 18:25:05 +0000</pubDate>
 <dc:creator>rho</dc:creator>
 <guid isPermaLink="false">158 at http://theoleschool.com</guid>
</item>
<item>
 <title>Using the Data Module&#039;s &quot;Relate to Node&quot; Functionality</title>
 <link>http://theoleschool.com/blog/using-data-modules-relate-node-functionality</link>
 <description>&lt;div class=&quot;field field-name-body field-type-text-with-summary field-label-hidden&quot;&gt;&lt;div class=&quot;field-items&quot;&gt;&lt;div class=&quot;field-item even&quot; property=&quot;content:encoded&quot;&gt;&lt;p&gt;While I&#039;m &lt;a href=&quot;/blog/adopting-table-schema-using-data-module&quot;&gt;on the topic&lt;/a&gt; of the &lt;a href=&quot;http://drupal.org/project/data&quot;&gt;Data module&lt;/a&gt;, I&#039;d like to share my thoughts on some of the confusion surrounding use of the Data Node module included with the package. (see issues &lt;a href=&quot;http://drupal.org/node/976292&quot;&gt;976292&lt;/a&gt; and &lt;a href=&quot;http://drupal.org/node/898562&quot;&gt;898562&lt;/a&gt;)&lt;/p&gt;
&lt;p&gt;It&#039;s my opinion that the bulk of the functionality in the Data Node module has been intentionally &quot;left undone.&quot; Instead, the module is giving us the tools to allow us to implement node relationships as needed, ourselves (think API).  My thinking is that this was done to allow the maximum amount of flexibility in relating other data to nodes by minimizing assumptions about what the relationship should be. &lt;em&gt;I have in no way validated this with any of the module maintainers, nor is it denoted in any documentation that I am aware of.&lt;/em&gt;  What follows is my &quot;average&quot; use case for this module, and some thoughts on more advanced implementations.&lt;/p&gt;
&lt;img src=&quot;/sites/default/files/u3/relate-to-node-form.png&quot; style=&quot;float:right; margin: 0 0 0 10px; width:250px;&quot; /&gt;&lt;p&gt;When enabled, this functionality is apparent in Drupal&#039;s admin UI at &lt;span class=&quot;geshifilter&quot;&gt;&lt;code class=&quot;php geshifilter-php&quot;&gt;admin&lt;span style=&quot;color: #339933;&quot;&gt;/&lt;/span&gt;build&lt;span style=&quot;color: #339933;&quot;&gt;/&lt;/span&gt;data&lt;span style=&quot;color: #339933;&quot;&gt;/&lt;/span&gt;edit&lt;span style=&quot;color: #339933;&quot;&gt;/%&lt;/span&gt;table_name&lt;span style=&quot;color: #339933;&quot;&gt;/&lt;/span&gt;node&lt;/code&gt;&lt;/span&gt; by clicking on the edit link next to a table at &lt;span class=&quot;geshifilter&quot;&gt;&lt;code class=&quot;php geshifilter-php&quot;&gt;admin&lt;span style=&quot;color: #339933;&quot;&gt;/&lt;/span&gt;build&lt;span style=&quot;color: #339933;&quot;&gt;/&lt;/span&gt;data&lt;span style=&quot;color: #339933;&quot;&gt;/&lt;/span&gt;overview&lt;/code&gt;&lt;/span&gt; then clicking the &quot;Relate to Nodes&quot; tab.  This page presents a form asking you which content type you would like the table related to, and the column name of the id key in the table you are referencing.  Simple right?  Well sorta...  When you submit this form and happily skip over to views to reference the node table, it quickly becomes apparent that nothing has happened.  Checking the &lt;span class=&quot;geshifilter&quot;&gt;&lt;code class=&quot;php geshifilter-php&quot;&gt;data_table_node&lt;/code&gt;&lt;/span&gt; table in the database will reveal it to be empty.  So what&#039;s up here?  Is this just an unfinished piece?&lt;/p&gt;
&lt;p&gt;After taking a look in the data_node.module things start to make a bit more sense.  At first glance we see some tantalizing functions, especially:&lt;/p&gt;
&lt;div class=&quot;geshifilter&quot;&gt;&lt;div class=&quot;drupal6 geshifilter-drupal6&quot; style=&quot;font-family:monospace;&quot;&gt;&lt;span style=&quot;color: #808080; font-style: italic;&quot;&gt;/**&lt;br /&gt;
 * Add a relationship between a data table and a node.&lt;br /&gt;
 */&lt;/span&gt;&lt;br /&gt;&lt;span style=&quot;color: #000000; font-weight: bold;&quot;&gt;function&lt;/span&gt; data_node_add&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;$table&lt;/span&gt;, &lt;span style=&quot;color: #0000ff;&quot;&gt;$id&lt;/span&gt;, &lt;span style=&quot;color: #0000ff;&quot;&gt;$nid&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #66cc66;&quot;&gt;{&lt;/span&gt;&lt;br /&gt;
  &lt;span style=&quot;color: #0000ff;&quot;&gt;$save&lt;/span&gt; = &lt;a href=&quot;http://www.php.net/array&quot;&gt;&lt;span style=&quot;color: #000066;&quot;&gt;array&lt;/span&gt;&lt;/a&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;br /&gt;
    &lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;data_table_name&#039;&lt;/span&gt; =&lt;span style=&quot;color: #66cc66;&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&quot;color: #0000ff;&quot;&gt;$table&lt;/span&gt;-&lt;span style=&quot;color: #66cc66;&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #006600;&quot;&gt;get&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;name&#039;&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt;,&lt;br /&gt;
    &lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;id&#039;&lt;/span&gt; =&lt;span style=&quot;color: #66cc66;&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&quot;color: #0000ff;&quot;&gt;$id&lt;/span&gt;,&lt;br /&gt;
    &lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;nid&#039;&lt;/span&gt; =&lt;span style=&quot;color: #66cc66;&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&quot;color: #0000ff;&quot;&gt;$nid&lt;/span&gt;,&lt;br /&gt;
  &lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt;;&lt;br /&gt;
  &lt;span style=&quot;color: #b1b100;&quot;&gt;return&lt;/span&gt; &lt;a href=&quot;http://api.drupal.org/api/function/drupal_write_record/6&quot;&gt;&lt;span style=&quot;color: #000066;&quot;&gt;drupal_write_record&lt;/span&gt;&lt;/a&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;data_table_node&#039;&lt;/span&gt;, &lt;span style=&quot;color: #0000ff;&quot;&gt;$save&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt;;&lt;br /&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;}&lt;/span&gt;&lt;br /&gt;&lt;span style=&quot;color: #808080; font-style: italic;&quot;&gt;/**&lt;br /&gt;
 * Remove a relationship between a data table and a node.&lt;br /&gt;
 */&lt;/span&gt;&lt;br /&gt;&lt;span style=&quot;color: #000000; font-weight: bold;&quot;&gt;function&lt;/span&gt; data_node_remove&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;$table&lt;/span&gt;, &lt;span style=&quot;color: #0000ff;&quot;&gt;$id&lt;/span&gt;, &lt;span style=&quot;color: #0000ff;&quot;&gt;$nid&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #66cc66;&quot;&gt;{&lt;/span&gt;&lt;br /&gt;
  &lt;a href=&quot;http://api.drupal.org/api/function/db_query/6&quot;&gt;&lt;span style=&quot;color: #000066;&quot;&gt;db_query&lt;/span&gt;&lt;/a&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #ff0000;&quot;&gt;&quot;DELETE FROM {data_table_node} WHERE data_table_name = &#039;%s&#039; AND id = %d AND nid = %d&quot;&lt;/span&gt;, &lt;span style=&quot;color: #0000ff;&quot;&gt;$table&lt;/span&gt;-&lt;span style=&quot;color: #66cc66;&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #006600;&quot;&gt;get&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;name&#039;&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt;, &lt;span style=&quot;color: #0000ff;&quot;&gt;$id&lt;/span&gt;, &lt;span style=&quot;color: #0000ff;&quot;&gt;$nid&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt;;&lt;br /&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Typically I&#039;ll stop right here.  I really only use the Data module for custom reporting, and when doing so I handle the CRUD functions for the new data type myself.  My data type&#039;s row reference to nodes are nearly always a 1 to 1 mapping.  To further simplify things for myself, the &lt;span class=&quot;geshifilter&quot;&gt;&lt;code class=&quot;php geshifilter-php&quot;&gt;&lt;span style=&quot;color: #000088;&quot;&gt;$id&lt;/span&gt;&lt;/code&gt;&lt;/span&gt; I use in my custom data type is often the node id of it&#039;s intended reference.  This makes my calls to these functions look something like:&lt;/p&gt;
&lt;div class=&quot;geshifilter&quot;&gt;&lt;div class=&quot;drupal6 geshifilter-drupal6&quot; style=&quot;font-family:monospace;&quot;&gt;  &lt;span style=&quot;color: #808080; font-style: italic;&quot;&gt;//insert my_table with a nid key&lt;/span&gt;&lt;br /&gt;
  ...&lt;br /&gt;
  &lt;span style=&quot;color: #808080; font-style: italic;&quot;&gt;//inform Data Node of the reference&lt;/span&gt;&lt;br /&gt;
  &lt;span style=&quot;color: #0000ff;&quot;&gt;$my_table_object&lt;/span&gt; = data_get_table&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;my_table&#039;&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt;;&lt;br /&gt;
  data_node_add&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;$my_table_object&lt;/span&gt;, &lt;span style=&quot;color: #0000ff;&quot;&gt;$nid&lt;/span&gt;, &lt;span style=&quot;color: #0000ff;&quot;&gt;$nid&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt;;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This will populate the &lt;span class=&quot;geshifilter&quot;&gt;&lt;code class=&quot;php geshifilter-php&quot;&gt;data_table_node&lt;/code&gt;&lt;/span&gt; table so that when we use the relationship in out data type view it will return results.  Of course deletion will be handled similarly.&lt;/p&gt;
&lt;p&gt;This is admittedly a somewhat basal interaction with this module, though it is often enough to satisfy my needs.  However Data Node allows for much more complexity and has a certain level of user interaction built in just below the surface.&lt;/p&gt;
&lt;p&gt;It&#039;s not until we start thinking about the data structures involved that the scope of the allowed complexity becomes apparent. It is easy to assume that referencing a data type to a node is always going to be 1 to 1 (much like the typical use of CCK&#039;s Node Reference.)  However, this may not always be the case.  It is not required that the data table&#039;s id be the nid of the node it is referencing.  It only has to be unique within the table. Because of this, a large field of possibilities emerge. You may have data type rows referencing many nodes each (1 to many), many data type rows referencing a single node (many to 1), or, of course, any number of data type rows referencing any number of nodes (many to many).  The &lt;span class=&quot;geshifilter&quot;&gt;&lt;code class=&quot;php geshifilter-php&quot;&gt;data_table_node&lt;/code&gt;&lt;/span&gt; table along with the provided CRUD functions, like the ones mentioned above, will allow for this. I think that this flexibility is a big reason that the module has been left so open.&lt;/p&gt;
&lt;p&gt;Lastly, a closer look at the Data Node module will reveal some rather fancy display functions for the underlying relationship CRUD.&lt;/p&gt;
&lt;div class=&quot;geshifilter&quot;&gt;&lt;div class=&quot;drupal6 geshifilter-drupal6&quot; style=&quot;font-family:monospace;&quot;&gt;&lt;span style=&quot;color: #808080; font-style: italic;&quot;&gt;/**&lt;br /&gt;
 * Render an add link for a given item..&lt;br /&gt;
 */&lt;/span&gt;&lt;br /&gt;&lt;span style=&quot;color: #000000; font-weight: bold;&quot;&gt;function&lt;/span&gt; data_node_render_add_link&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;$table&lt;/span&gt;, &lt;span style=&quot;color: #0000ff;&quot;&gt;$id&lt;/span&gt;, &lt;span style=&quot;color: #0000ff;&quot;&gt;$nid&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #66cc66;&quot;&gt;{&lt;/span&gt;&lt;br /&gt;
  &lt;a href=&quot;http://api.drupal.org/api/function/drupal_add_css/6&quot;&gt;&lt;span style=&quot;color: #000066;&quot;&gt;drupal_add_css&lt;/span&gt;&lt;/a&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;a href=&quot;http://api.drupal.org/api/function/drupal_get_path/6&quot;&gt;&lt;span style=&quot;color: #000066;&quot;&gt;drupal_get_path&lt;/span&gt;&lt;/a&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;module&#039;&lt;/span&gt;, &lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;data_node&#039;&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt; . &lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;/data_node.css&#039;&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt;;&lt;br /&gt;
  &lt;a href=&quot;http://api.drupal.org/api/function/drupal_add_js/6&quot;&gt;&lt;span style=&quot;color: #000066;&quot;&gt;drupal_add_js&lt;/span&gt;&lt;/a&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;a href=&quot;http://api.drupal.org/api/function/drupal_get_path/6&quot;&gt;&lt;span style=&quot;color: #000066;&quot;&gt;drupal_get_path&lt;/span&gt;&lt;/a&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;module&#039;&lt;/span&gt;, &lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;data_node&#039;&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt; . &lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;/data_node.js&#039;&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt;;&lt;br /&gt;&lt;br /&gt;
  &lt;span style=&quot;color: #0000ff;&quot;&gt;$title&lt;/span&gt; = _data_node_get_title&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;$nid&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt;;&lt;br /&gt;
  &lt;span style=&quot;color: #0000ff;&quot;&gt;$table_name&lt;/span&gt; = &lt;span style=&quot;color: #0000ff;&quot;&gt;$table&lt;/span&gt;-&lt;span style=&quot;color: #66cc66;&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #006600;&quot;&gt;get&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;name&#039;&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt;;&lt;br /&gt;
  &lt;span style=&quot;color: #0000ff;&quot;&gt;$class&lt;/span&gt; = &lt;span style=&quot;color: #ff0000;&quot;&gt;&quot;data_node_link-{$table_name}-{$id}-{$nid}&quot;&lt;/span&gt;;&lt;br /&gt;
  &lt;span style=&quot;color: #b1b100;&quot;&gt;return&lt;/span&gt; &lt;a href=&quot;http://api.drupal.org/api/function/l/6&quot;&gt;&lt;span style=&quot;color: #000066;&quot;&gt;l&lt;/span&gt;&lt;/a&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;a href=&quot;http://api.drupal.org/api/function/t/6&quot;&gt;&lt;span style=&quot;color: #000066;&quot;&gt;t&lt;/span&gt;&lt;/a&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;Add to !title&#039;&lt;/span&gt;, &lt;a href=&quot;http://www.php.net/array&quot;&gt;&lt;span style=&quot;color: #000066;&quot;&gt;array&lt;/span&gt;&lt;/a&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;!title&#039;&lt;/span&gt; =&lt;span style=&quot;color: #66cc66;&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&quot;color: #0000ff;&quot;&gt;$title&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt;, data_node_add_path&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;$table&lt;/span&gt;, &lt;span style=&quot;color: #0000ff;&quot;&gt;$id&lt;/span&gt;, &lt;span style=&quot;color: #0000ff;&quot;&gt;$nid&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt;, &lt;a href=&quot;http://www.php.net/array&quot;&gt;&lt;span style=&quot;color: #000066;&quot;&gt;array&lt;/span&gt;&lt;/a&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;attributes&#039;&lt;/span&gt; =&lt;span style=&quot;color: #66cc66;&quot;&gt;&amp;gt;&lt;/span&gt; &lt;a href=&quot;http://www.php.net/array&quot;&gt;&lt;span style=&quot;color: #000066;&quot;&gt;array&lt;/span&gt;&lt;/a&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;class&#039;&lt;/span&gt; =&lt;span style=&quot;color: #66cc66;&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&quot;color: #ff0000;&quot;&gt;&quot;data-node-add $class&quot;&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt;, &lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;query&#039;&lt;/span&gt; =&lt;span style=&quot;color: #66cc66;&quot;&gt;&amp;gt;&lt;/span&gt; &lt;a href=&quot;http://api.drupal.org/api/function/drupal_get_destination/6&quot;&gt;&lt;span style=&quot;color: #000066;&quot;&gt;drupal_get_destination&lt;/span&gt;&lt;/a&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt;;&lt;br /&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;}&lt;/span&gt;&lt;br /&gt;&lt;br /&gt;&lt;span style=&quot;color: #808080; font-style: italic;&quot;&gt;/**&lt;br /&gt;
 * Render a remove link for a given item.&lt;br /&gt;
 */&lt;/span&gt;&lt;br /&gt;&lt;span style=&quot;color: #000000; font-weight: bold;&quot;&gt;function&lt;/span&gt; data_node_render_remove_link&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;$table&lt;/span&gt;, &lt;span style=&quot;color: #0000ff;&quot;&gt;$id&lt;/span&gt;, &lt;span style=&quot;color: #0000ff;&quot;&gt;$nid&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #66cc66;&quot;&gt;{&lt;/span&gt;&lt;br /&gt;
  &lt;a href=&quot;http://api.drupal.org/api/function/drupal_add_css/6&quot;&gt;&lt;span style=&quot;color: #000066;&quot;&gt;drupal_add_css&lt;/span&gt;&lt;/a&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;a href=&quot;http://api.drupal.org/api/function/drupal_get_path/6&quot;&gt;&lt;span style=&quot;color: #000066;&quot;&gt;drupal_get_path&lt;/span&gt;&lt;/a&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;module&#039;&lt;/span&gt;, &lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;data_node&#039;&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt; . &lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;/data_node.css&#039;&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt;;&lt;br /&gt;
  &lt;a href=&quot;http://api.drupal.org/api/function/drupal_add_js/6&quot;&gt;&lt;span style=&quot;color: #000066;&quot;&gt;drupal_add_js&lt;/span&gt;&lt;/a&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;a href=&quot;http://api.drupal.org/api/function/drupal_get_path/6&quot;&gt;&lt;span style=&quot;color: #000066;&quot;&gt;drupal_get_path&lt;/span&gt;&lt;/a&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;module&#039;&lt;/span&gt;, &lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;data_node&#039;&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt; . &lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;/data_node.js&#039;&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt;;&lt;br /&gt;&lt;br /&gt;
  &lt;span style=&quot;color: #0000ff;&quot;&gt;$title&lt;/span&gt; = _data_node_get_title&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;$nid&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt;;&lt;br /&gt;
  &lt;span style=&quot;color: #0000ff;&quot;&gt;$table_name&lt;/span&gt; = &lt;span style=&quot;color: #0000ff;&quot;&gt;$table&lt;/span&gt;-&lt;span style=&quot;color: #66cc66;&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #006600;&quot;&gt;get&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;name&#039;&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt;;&lt;br /&gt;
  &lt;span style=&quot;color: #0000ff;&quot;&gt;$class&lt;/span&gt; = &lt;span style=&quot;color: #ff0000;&quot;&gt;&quot;data_node_link-{$table_name}-{$id}-{$nid}&quot;&lt;/span&gt;;&lt;br /&gt;
  &lt;span style=&quot;color: #b1b100;&quot;&gt;return&lt;/span&gt; &lt;a href=&quot;http://api.drupal.org/api/function/l/6&quot;&gt;&lt;span style=&quot;color: #000066;&quot;&gt;l&lt;/span&gt;&lt;/a&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;a href=&quot;http://api.drupal.org/api/function/t/6&quot;&gt;&lt;span style=&quot;color: #000066;&quot;&gt;t&lt;/span&gt;&lt;/a&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;Remove from !title&#039;&lt;/span&gt;, &lt;a href=&quot;http://www.php.net/array&quot;&gt;&lt;span style=&quot;color: #000066;&quot;&gt;array&lt;/span&gt;&lt;/a&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;!title&#039;&lt;/span&gt; =&lt;span style=&quot;color: #66cc66;&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&quot;color: #0000ff;&quot;&gt;$title&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt;, data_node_remove_path&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;$table&lt;/span&gt;, &lt;span style=&quot;color: #0000ff;&quot;&gt;$id&lt;/span&gt;, &lt;span style=&quot;color: #0000ff;&quot;&gt;$nid&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt;, &lt;a href=&quot;http://www.php.net/array&quot;&gt;&lt;span style=&quot;color: #000066;&quot;&gt;array&lt;/span&gt;&lt;/a&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;attributes&#039;&lt;/span&gt; =&lt;span style=&quot;color: #66cc66;&quot;&gt;&amp;gt;&lt;/span&gt; &lt;a href=&quot;http://www.php.net/array&quot;&gt;&lt;span style=&quot;color: #000066;&quot;&gt;array&lt;/span&gt;&lt;/a&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;class&#039;&lt;/span&gt; =&lt;span style=&quot;color: #66cc66;&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&quot;color: #ff0000;&quot;&gt;&quot;data-node-remove $class&quot;&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt;, &lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;query&#039;&lt;/span&gt; =&lt;span style=&quot;color: #66cc66;&quot;&gt;&amp;gt;&lt;/span&gt; &lt;a href=&quot;http://api.drupal.org/api/function/drupal_get_destination/6&quot;&gt;&lt;span style=&quot;color: #000066;&quot;&gt;drupal_get_destination&lt;/span&gt;&lt;/a&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt;;&lt;br /&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;These are the two pertinent functions. They both return a link that will hit a page callback to do just what you would expect. Add or remove a node relationship.  This allows you &quot;expose&quot; the functionality to the user.  The link could be placed on a view or node page to allow users to add or remove the relation to a specific data type themselves, &quot;on the fly&quot;.  This, in combination with the flexibility of the relationship itself, lends to a huge variety of possible use cases with relatively few function calls.&lt;/p&gt;
&lt;p&gt;So wrapping this up.  Data Node module is best thought of as an API.  It doesn&#039;t do so much right out of the box, but with minimal implementation it becomes a fairly powerful tool.&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;</description>
 <pubDate>Sun, 04 Mar 2012 03:44:18 +0000</pubDate>
 <dc:creator>rho</dc:creator>
 <guid isPermaLink="false">157 at http://theoleschool.com</guid>
</item>
<item>
 <title>Adopting a Table with Schema using Data Module</title>
 <link>http://theoleschool.com/blog/adopting-table-schema-using-data-module</link>
 <description>&lt;div class=&quot;field field-name-body field-type-text-with-summary field-label-hidden&quot;&gt;&lt;div class=&quot;field-items&quot;&gt;&lt;div class=&quot;field-item even&quot; property=&quot;content:encoded&quot;&gt;&lt;p&gt;When working with medium to larger sized web applications, inevitably the requirement comes up for some advanced data reporting.  The spectrum of requests here can obviously be pretty broad and is often beyond what you can accomplish with the default tables provided by Drupal and the installed modules.  This tends to lead us to creating custom tables to track and manage the requested reports.  Along with writing all of the necessary &lt;a href=&quot;http://en.wikipedia.org/wiki/Create,_read,_update_and_delete&quot;&gt;CRUD&lt;/a&gt; functions to make sure our new table is managing data appropriately,  we also have to provide some sort of display or an export.  Views can handle this latter requirement quite nicely.  So it is here that we can turn to modules like  &lt;a href=&quot;http://drupal.org/project/data&quot;&gt;Data&lt;/a&gt; or the now depricated &lt;a href=&quot;http://drupal.org/project/tw&quot;&gt;Table Wizard&lt;/a&gt; to bring our new table under views &quot;control.&quot; This gives us the added bonus of taking the display configuration out of the hands of the developer and placing it into the site builder/administrator&#039;s domain.&lt;/p&gt;
&lt;p&gt;In a recent project just such a reporting request came up.  The report was fairly complex and was to be visible to a larger subset of users.  I wound up managing this report with a custom table and I turned to Data module to allow views to handle the output.  After installing my custom module which created the custom table, I navigated to &lt;span class=&quot;geshifilter&quot;&gt;&lt;code class=&quot;php geshifilter-php&quot;&gt;admin&lt;span style=&quot;color: #339933;&quot;&gt;/&lt;/span&gt;build&lt;span style=&quot;color: #339933;&quot;&gt;/&lt;/span&gt;data&lt;span style=&quot;color: #339933;&quot;&gt;/&lt;/span&gt;adopt&lt;/code&gt;&lt;/span&gt;. Expecting to see my table in the list of &quot;adoptable&quot; tables, I was a bit confused when it was nowhere to be found.  After &lt;a href=&quot;http://drupal.org/node/888946#comment-3360326&quot;&gt;a bit of digging&lt;/a&gt; I realized that tables declared using &lt;a href=&quot;http://drupal.org/node/146843&quot;&gt;Schema API&lt;/a&gt; were considered &quot;owned&quot; by the module and not included in the list of adoptable tables.  This makes some sense as you don&#039;t want just any table adopted by Data.  Just imagine when an admin who&#039;s not quite sure what he or she is doing, decides to adopt and then drop the node table. I&#039;d rather not...&lt;/p&gt;
&lt;p&gt;So this leaves us with the question, &lt;em&gt;&quot;How do I get Data module to adopt my table?&quot;&lt;/em&gt;  From what I can tell, the creators of the data module expect us to use the Data API to handle table creation and CRUD.  Personally I don&#039;t like the idea of this.  I already understand and like working with Drupal&#039;s core Schema API, and don&#039;t want to adopt another layer of abstraction.  I only want to utilize Data module to throw my table up to views.  So after looking through how adoption is handled in the module, I found that really there is nothing preventing Data from adopting these schema declared tables. They are simply being made unavailable to the form at &lt;span class=&quot;geshifilter&quot;&gt;&lt;code class=&quot;php geshifilter-php&quot;&gt;admin&lt;span style=&quot;color: #339933;&quot;&gt;/&lt;/span&gt;build&lt;span style=&quot;color: #339933;&quot;&gt;/&lt;/span&gt;data&lt;span style=&quot;color: #339933;&quot;&gt;/&lt;/span&gt;adopt&lt;/code&gt;&lt;/span&gt;.  This lead me to attempt to adopt my table right after it is generated in my module&#039;s .install file.   This wound up working quite nicely and is implemented as follows:&lt;/p&gt;
&lt;div class=&quot;geshifilter&quot;&gt;&lt;div class=&quot;drupal6 geshifilter-drupal6&quot; style=&quot;font-family:monospace;&quot;&gt;&lt;span style=&quot;color: #000000; font-weight: bold;&quot;&gt;function&lt;/span&gt; my_module_install&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #66cc66;&quot;&gt;{&lt;/span&gt;&lt;br /&gt;
  &lt;span style=&quot;color: #808080; font-style: italic;&quot;&gt;//install schema as normal&lt;/span&gt;&lt;br /&gt;
  &lt;a href=&quot;http://api.drupal.org/api/function/drupal_install_schema/6&quot;&gt;&lt;span style=&quot;color: #000066;&quot;&gt;drupal_install_schema&lt;/span&gt;&lt;/a&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;my_table&#039;&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt;;&lt;br /&gt;
  &lt;br /&gt;
  &lt;span style=&quot;color: #808080; font-style: italic;&quot;&gt;//make sure we have the data module&lt;/span&gt;&lt;br /&gt;
  &lt;span style=&quot;color: #b1b100;&quot;&gt;include_once&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;a href=&quot;http://api.drupal.org/api/function/drupal_get_path/6&quot;&gt;&lt;span style=&quot;color: #000066;&quot;&gt;drupal_get_path&lt;/span&gt;&lt;/a&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;module&#039;&lt;/span&gt;, &lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;data&#039;&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt; .&lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;/data.module&#039;&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt;;&lt;br /&gt;
  data_include&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;DataTable&#039;&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt;;&lt;br /&gt;
  &lt;span style=&quot;color: #808080; font-style: italic;&quot;&gt;//instanciate the table we just created with the DataTable class&lt;/span&gt;&lt;br /&gt;
  &lt;span style=&quot;color: #0000ff;&quot;&gt;$my_table_object&lt;/span&gt; = DataTable::&lt;span style=&quot;color: #006600;&quot;&gt;instance&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;my_table&#039;&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt;;&lt;br /&gt;
  &lt;span style=&quot;color: #808080; font-style: italic;&quot;&gt;//tell Data module to adopt the table&lt;/span&gt;&lt;br /&gt;
  &lt;span style=&quot;color: #0000ff;&quot;&gt;$my_table_object&lt;/span&gt;-&lt;span style=&quot;color: #66cc66;&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #006600;&quot;&gt;adopt&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt;;&lt;br /&gt;
  DataTable::&lt;span style=&quot;color: #006600;&quot;&gt;clearCaches&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt;;&lt;br /&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;After installing the module you should be able to see your custom table at &lt;span class=&quot;geshifilter&quot;&gt;&lt;code class=&quot;php geshifilter-php&quot;&gt;admin&lt;span style=&quot;color: #339933;&quot;&gt;/&lt;/span&gt;build&lt;span style=&quot;color: #339933;&quot;&gt;/&lt;/span&gt;data&lt;/code&gt;&lt;/span&gt;.  Data module is now obviously a dependency so be sure that it is installed and enabled before installing your custom module.&lt;/p&gt;
&lt;p&gt;I realize that I could write my own views handlers for the custom table data I am providing, but I have found that to be a fairly time consuming (and often esoteric) task.  When all we are after is  a single, somewhat unique report, I feel that integration with the Data module and it&#039;s corresponding integration with views is simple, quick, and more than adequate.&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;</description>
 <pubDate>Sat, 03 Mar 2012 20:19:36 +0000</pubDate>
 <dc:creator>rho</dc:creator>
 <guid isPermaLink="false">156 at http://theoleschool.com</guid>
</item>
<item>
 <title>Quick Stock Quote on Page Refresh</title>
 <link>http://theoleschool.com/blog/quick-stock-quote-page-refresh-0</link>
 <description>&lt;div class=&quot;field field-name-body field-type-text-with-summary field-label-hidden&quot;&gt;&lt;div class=&quot;field-items&quot;&gt;&lt;div class=&quot;field-item even&quot; property=&quot;content:encoded&quot;&gt;&lt;p&gt;I thought I would throw a post up, demonstrating a &quot;quick and easy&quot; use case of the &lt;a href=&quot;http://drupal.org/project/stockapi&quot;&gt;Stock API module&lt;/a&gt;, and simultaneously, give this site&#039;s &lt;a href=&quot;http://qbnz.com/highlighter/&quot;&gt;GeSHi filter&lt;/a&gt;  a quick test run.&lt;/p&gt;
&lt;p&gt;A few days ago I encountered a site requirement asking for a simple informative stock quote block on a Drupal 6.x installation.  The format required was something like:
&lt;br /&gt;&lt;em&gt;NFLX 208.75 -1.30 Sep 13 7:30 EST&lt;/em&gt; 
&lt;br /&gt;
My initial thought was to enable the &lt;a href=&quot;http://drupal.org/project/stock&quot;&gt;Stock module&lt;/a&gt; and simply configure and theme the built in block.  The stock module will allow the management of multiple stocks on a per-user basis, and provides a block that displays this information in a table.  There is no doubt that stock module is useful but in this instance it is overkill. All we are after is a simple quote from a single unchanging stock symbol displayed in a single line of text.&lt;/p&gt;
&lt;p&gt;So let&#039;s take a short step back to the stock API module. There is really one &quot;go to&quot; function when grabbing a quote from the stock api and that is &lt;span class=&quot;geshifilter&quot;&gt;&lt;code class=&quot;php geshifilter-php&quot;&gt;stockapi_load&lt;span style=&quot;color: #009900;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #000088;&quot;&gt;$symbol&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/span&gt;. This function is defined like so:&lt;/p&gt;
&lt;div class=&quot;geshifilter&quot;&gt;&lt;div class=&quot;drupal6 geshifilter-drupal6&quot; style=&quot;font-family:monospace;&quot;&gt;&lt;span style=&quot;color: #000000; font-weight: bold;&quot;&gt;function&lt;/span&gt; stockapi_load&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;$symbol&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #66cc66;&quot;&gt;{&lt;/span&gt;&lt;br /&gt;
  &lt;span style=&quot;color: #b1b100;&quot;&gt;if&lt;/span&gt; &lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;!&lt;/span&gt;&lt;a href=&quot;http://www.php.net/empty&quot;&gt;&lt;span style=&quot;color: #000066;&quot;&gt;empty&lt;/span&gt;&lt;/a&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;$symbol&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #66cc66;&quot;&gt;{&lt;/span&gt;&lt;br /&gt;
    &lt;span style=&quot;color: #0000ff;&quot;&gt;$stock&lt;/span&gt; = &lt;a href=&quot;http://api.drupal.org/api/function/db_fetch_array/6&quot;&gt;&lt;span style=&quot;color: #000066;&quot;&gt;db_fetch_array&lt;/span&gt;&lt;/a&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;a href=&quot;http://api.drupal.org/api/function/db_query/6&quot;&gt;&lt;span style=&quot;color: #000066;&quot;&gt;db_query&lt;/span&gt;&lt;/a&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #ff0000;&quot;&gt;&quot;SELECT * FROM {stockapi} WHERE symbol = &#039;%s&#039;&quot;&lt;/span&gt;, &lt;span style=&quot;color: #0000ff;&quot;&gt;$symbol&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt;;&lt;br /&gt;
    &lt;span style=&quot;color: #b1b100;&quot;&gt;if&lt;/span&gt; &lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;!&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;$stock&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #66cc66;&quot;&gt;{&lt;/span&gt;&lt;br /&gt;
      &lt;span style=&quot;color: #0000ff;&quot;&gt;$stock&lt;/span&gt; = stockapi_fetch&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;$symbol&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt;;&lt;br /&gt;
      &lt;span style=&quot;color: #b1b100;&quot;&gt;if&lt;/span&gt; &lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;$stock&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #66cc66;&quot;&gt;{&lt;/span&gt;&lt;br /&gt;
        &lt;span style=&quot;color: #b1b100;&quot;&gt;if&lt;/span&gt; &lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;$stock&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #cc66cc;&quot;&gt;8&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;]&lt;/span&gt; &lt;span style=&quot;color: #66cc66;&quot;&gt;!&lt;/span&gt;= &lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;N/A&#039;&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #66cc66;&quot;&gt;{&lt;/span&gt;&lt;br /&gt;
          &lt;span style=&quot;color: #808080; font-style: italic;&quot;&gt;// Date is &#039;N/A&#039; means an invalid stock symbol&lt;/span&gt;&lt;br /&gt;
          stockapi_save&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;$stock&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt;;&lt;br /&gt;&lt;br /&gt;
          &lt;span style=&quot;color: #808080; font-style: italic;&quot;&gt;// Load again so it can show for the first time&lt;/span&gt;&lt;br /&gt;
          &lt;span style=&quot;color: #0000ff;&quot;&gt;$stock&lt;/span&gt; = stockapi_load&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;$symbol&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt;;&lt;br /&gt;
        &lt;span style=&quot;color: #66cc66;&quot;&gt;}&lt;/span&gt;&lt;br /&gt;
      &lt;span style=&quot;color: #66cc66;&quot;&gt;}&lt;/span&gt;&lt;br /&gt;
    &lt;span style=&quot;color: #66cc66;&quot;&gt;}&lt;/span&gt;&lt;br /&gt;
  &lt;span style=&quot;color: #66cc66;&quot;&gt;}&lt;/span&gt;&lt;br /&gt;
  &lt;span style=&quot;color: #b1b100;&quot;&gt;return&lt;/span&gt; &lt;span style=&quot;color: #0000ff;&quot;&gt;$stock&lt;/span&gt;;&lt;br /&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;As you can see the stock API module is wanting to store stock information in the database to be updated on cron runs.  It does this as a type of database caching.  This way if a site is pulling information on many stocks, potentially every page load, compounded by many users the API can retrieve the information with a simple query to the local database. Not only is this method much faster than hitting the third party service (yahoo) every time, it is able to serve saved information (especially handy if that service happens to be down or a connection cannot be established).  This feature along with returning a nice keyed array of stock information is reason enough to love this function. However, I think we could go a bit simpler still.  We only need information on one stock site wide, and in this instance that information should be as current as possible. Furthermore, I would like to avoid setting up a cron job to run every half hour just to keep stock information current. Rather, we look further into the Stock API and make a more basal call to &lt;span class=&quot;geshifilter&quot;&gt;&lt;code class=&quot;php geshifilter-php&quot;&gt;stockapi_fetch&lt;span style=&quot;color: #009900;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #000088;&quot;&gt;$symbol&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #339933;&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/span&gt;.  This function is a direct call to the 3rd party service, in this case yahoo:&lt;/p&gt;
&lt;div class=&quot;geshifilter&quot;&gt;&lt;div class=&quot;drupal6 geshifilter-drupal6&quot; style=&quot;font-family:monospace;&quot;&gt;&lt;span style=&quot;color: #808080; font-style: italic;&quot;&gt;/**&lt;br /&gt;
 * Fetch the stock info for a given ticker symbol from Yahoo!&lt;br /&gt;
 */&lt;/span&gt;&lt;br /&gt;&lt;span style=&quot;color: #000000; font-weight: bold;&quot;&gt;function&lt;/span&gt; stockapi_fetch&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;$symbol&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #66cc66;&quot;&gt;{&lt;/span&gt;&lt;br /&gt;
  &lt;span style=&quot;color: #b1b100;&quot;&gt;if&lt;/span&gt; &lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;a href=&quot;http://www.php.net/empty&quot;&gt;&lt;span style=&quot;color: #000066;&quot;&gt;empty&lt;/span&gt;&lt;/a&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;$symbol&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #66cc66;&quot;&gt;{&lt;/span&gt;&lt;br /&gt;
    &lt;span style=&quot;color: #b1b100;&quot;&gt;return&lt;/span&gt; &lt;span style=&quot;color: #000000; font-weight: bold;&quot;&gt;FALSE&lt;/span&gt;;&lt;br /&gt;
  &lt;span style=&quot;color: #66cc66;&quot;&gt;}&lt;/span&gt;&lt;br /&gt;&lt;br /&gt;
  &lt;span style=&quot;color: #0000ff;&quot;&gt;$fields&lt;/span&gt; = &lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;snl1c1ohgvd1t1&#039;&lt;/span&gt;;&lt;br /&gt;
  &lt;span style=&quot;color: #808080; font-style: italic;&quot;&gt;/*&lt;br /&gt;
    &quot;s&quot;  =&amp;gt; &quot;Symbol&quot;,&lt;br /&gt;
    &quot;n&quot;  =&amp;gt; &quot;Name&quot;,&lt;br /&gt;
    &quot;l1&quot; =&amp;gt; &quot;Last&quot;,&lt;br /&gt;
    &quot;c1&quot; =&amp;gt; &quot;Change&quot;,&lt;br /&gt;
    &quot;o&quot;  =&amp;gt; &quot;Opening&quot;,&lt;br /&gt;
    &quot;h&quot;  =&amp;gt; &quot;High&quot;,&lt;br /&gt;
    &quot;g&quot;  =&amp;gt; &quot;Low&quot;,&lt;br /&gt;
    &quot;v&quot;  =&amp;gt; &quot;Volume&quot;,&lt;br /&gt;
    &quot;d1&quot; =&amp;gt; &quot;Date&quot;,&lt;br /&gt;
    &quot;t1&quot; =&amp;gt; &quot;Time&quot;&lt;br /&gt;
   */&lt;/span&gt;&lt;br /&gt;&lt;br /&gt;
  &lt;span style=&quot;color: #0000ff;&quot;&gt;$host&lt;/span&gt; = &lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;http://download.finance.yahoo.com&#039;&lt;/span&gt;;&lt;br /&gt;
  &lt;span style=&quot;color: #0000ff;&quot;&gt;$url&lt;/span&gt; = &lt;span style=&quot;color: #0000ff;&quot;&gt;$host&lt;/span&gt; .&lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;/d/quotes.csv?s=&#039;&lt;/span&gt;. &lt;a href=&quot;http://www.php.net/urlencode&quot;&gt;&lt;span style=&quot;color: #000066;&quot;&gt;urlencode&lt;/span&gt;&lt;/a&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;$symbol&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt; .&lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;&amp;amp;f=&#039;&lt;/span&gt;.&lt;span style=&quot;color: #0000ff;&quot;&gt;$fields&lt;/span&gt;.&lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;&amp;amp;e=.csv&#039;&lt;/span&gt;;&lt;br /&gt;&lt;br /&gt;
  &lt;span style=&quot;color: #0000ff;&quot;&gt;$result&lt;/span&gt; = &lt;a href=&quot;http://api.drupal.org/api/function/drupal_http_request/6&quot;&gt;&lt;span style=&quot;color: #000066;&quot;&gt;drupal_http_request&lt;/span&gt;&lt;/a&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;$url&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt;;&lt;br /&gt;
  ...&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This ensures fresh data, without a cron run to update the database.  This function is not quite as nice as the &lt;span class=&quot;geshifilter&quot;&gt;&lt;code class=&quot;php geshifilter-php&quot;&gt;stockapi_load&lt;span style=&quot;color: #009900;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #009900;&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/span&gt; function in that the array it returns is not keyed.  The commented section above (from the module) comes to the rescue. It is in the same sequence as the array returned so it can be used as a reference. So to return something like our requirement example above:&lt;br /&gt;&lt;em&gt;NFLX 208.75 -1.30 Sep 13 7:30 EST&lt;/em&gt;&lt;br /&gt;
We would write something like:&lt;/p&gt;
&lt;div class=&quot;geshifilter&quot;&gt;&lt;div class=&quot;drupal6 geshifilter-drupal6&quot; style=&quot;font-family:monospace;&quot;&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;$output&lt;/span&gt; = &lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;&#039;&lt;/span&gt;;&lt;br /&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;$my_stock&lt;/span&gt; = stockapi_fetch&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;NFLX&#039;&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt;;&lt;br /&gt;&lt;span style=&quot;color: #b1b100;&quot;&gt;if&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;$my_stock&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color: #66cc66;&quot;&gt;{&lt;/span&gt;&lt;br /&gt;
  &lt;span style=&quot;color: #0000ff;&quot;&gt;$output&lt;/span&gt; .= &lt;span style=&quot;color: #ff0000;&quot;&gt;&#039;&amp;lt;span class=&quot;my-stock-quote&quot;&amp;gt;&#039;&lt;/span&gt;.&lt;span style=&quot;color: #0000ff;&quot;&gt;$my_stock&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #cc66cc;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;]&lt;/span&gt;.&lt;span style=&quot;color: #ff0000;&quot;&gt;&#039; &#039;&lt;/span&gt;.&lt;span style=&quot;color: #0000ff;&quot;&gt;$my_stock&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #cc66cc;&quot;&gt;2&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;]&lt;/span&gt;.&lt;span style=&quot;color: #ff0000;&quot;&gt;&#039; &#039;&lt;/span&gt;.&lt;span style=&quot;color: #0000ff;&quot;&gt;$my_stock&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #cc66cc;&quot;&gt;3&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;]&lt;/span&gt;.&lt;span style=&quot;color: #ff0000;&quot;&gt;&#039; &#039;&lt;/span&gt;.&lt;span style=&quot;color: #0000ff;&quot;&gt;$my_stock&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #cc66cc;&quot;&gt;8&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;]&lt;/span&gt;.&lt;span style=&quot;color: #ff0000;&quot;&gt;&#039; &#039;&lt;/span&gt;.&lt;span style=&quot;color: #0000ff;&quot;&gt;$my_stock&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: #cc66cc;&quot;&gt;9&lt;/span&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;]&lt;/span&gt;.&lt;span style=&quot;color: #ff0000;&quot;&gt;&#039; EST&amp;lt;/span&amp;gt;&#039;&lt;/span&gt;;&lt;br /&gt;&lt;span style=&quot;color: #66cc66;&quot;&gt;}&lt;/span&gt;&lt;br /&gt;&lt;span style=&quot;color: #b1b100;&quot;&gt;return&lt;/span&gt; &lt;span style=&quot;color: #0000ff;&quot;&gt;$output&lt;/span&gt;;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I wound up throwing a variant of the snippet above into a block created in my module, allowing me to then jump to panels and throw the output wherever I wanted.&lt;/p&gt; 
&lt;p&gt;Now I know... the example is somewhat contrived. There is no &quot;secret&quot; here.  Everything outlined in this post would quickly be revealed by only a few minutes of looking through the Stock API module.  I wanted to demonstrate that by making a simple call to the Stock API I was able to save significant time in themeing, as well as gain flexibility in function.  The alternative would be wrangling the output of the Stock module&#039;s block, and making concessions for it&#039;s functional behavior.  It is easy to fall into the thinking that Drupal site building is just finding a module that is a closest fit and wrestling with what it gives us. Indeed sometimes that may be the case (Organic Groups comes to mind), but to follow that line of thinking blindly is most certainly a mistake.&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;</description>
 <pubDate>Fri, 16 Sep 2011 04:28:56 +0000</pubDate>
 <dc:creator>rho</dc:creator>
 <guid isPermaLink="false">154 at http://theoleschool.com</guid>
</item>
</channel>
</rss>
