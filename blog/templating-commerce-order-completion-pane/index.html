<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML+RDFa 1.0//EN"
  "http://www.w3.org/MarkUp/DTD/xhtml-rdfa-1.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" version="XHTML+RDFa 1.0" dir="ltr"
  xmlns:content="http://purl.org/rss/1.0/modules/content/"
  xmlns:dc="http://purl.org/dc/terms/"
  xmlns:foaf="http://xmlns.com/foaf/0.1/"
  xmlns:og="http://ogp.me/ns#"
  xmlns:rdfs="http://www.w3.org/2000/01/rdf-schema#"
  xmlns:sioc="http://rdfs.org/sioc/ns#"
  xmlns:sioct="http://rdfs.org/sioc/types#"
  xmlns:skos="http://www.w3.org/2004/02/skos/core#"
  xmlns:xsd="http://www.w3.org/2001/XMLSchema#">


<!-- Mirrored from theoleschool.com/blog/templating-commerce-order-completion-pane by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 26 Sep 2015 17:07:12 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head profile="http://www.w3.org/1999/xhtml/vocab">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta content="Templating the Commerce Order Completion Pane" about="/blog/templating-commerce-order-completion-pane" property="dc:title" />
<link rel="shortcut icon" href="../../misc/favicon/index.ico" type="image/vnd.microsoft.icon" />
<meta name="generator" content="Drupal 7 (http://drupal.org)" />
<meta name="keywords" content="drupal, web development, commerce" />
<link rel="canonical" href="index.html" />
<link rel="shortlink" href="index.html" />
  <title>Templating the Commerce Order Completion Pane | theoleschool</title>
  <link type="text/css" rel="stylesheet" href="../../sites/default/files/css/css_pbm0lsQQJ7A7WCCIMgxLho6mI_kBNgznNUWmTWcnfoE/index.css" media="all" />
<link type="text/css" rel="stylesheet" href="../../sites/default/files/css/css_botNHIYRQPys-RH2iA3U4LbV9bPNRS64tLAs8ec1ch8/index.css" media="all" />
<link type="text/css" rel="stylesheet" href="../../sites/default/files/css/css_ggwmJjnSHIyQGr6BcS46i7z-SeJR7vFJ2H8b7fsUJ1o/index.css" media="all" />
<link type="text/css" rel="stylesheet" href="../../sites/default/files/css/css_wTnXwKLp1ec_eSA6aRSbc1Cr7mXlDTPbLelDm9ZTjQg/index.css" media="screen" />
  <script type="text/javascript" src="../../sites/default/files/js/js_xAPl0qIk9eowy_iS9tNkCWXLUVoat94SQT48UBCFkyQ/index.js"></script>
<script type="text/javascript" src="../../sites/default/files/js/js_mEEqrZApHAidJyywsmZR_Ac1d4B-4FLzvR9sbsjVDyg/index.js"></script>
<script type="text/javascript" src="../../sites/default/files/js/js_IDBX5SzkJ9gGNq7x-qOE_2DZsexqguTJQGMKvi4w-Uw/index.js"></script>
<script type="text/javascript">
<!--//--><![CDATA[//><!--
var _gaq = _gaq || [];_gaq.push(["_setAccount", "UA-25692833-1"]);_gaq.push(["_trackPageview"]);(function() {var ga = document.createElement("script");ga.type = "text/javascript";ga.async = true;ga.src = "../../sites/default/files/googleanalytics/ga/index.js?nvammp";var s = document.getElementsByTagName("script")[0];s.parentNode.insertBefore(ga, s);})();
//--><!]]>
</script>
<script type="text/javascript">
<!--//--><![CDATA[//><!--
jQuery.extend(Drupal.settings, {"basePath":"\/","pathPrefix":"","ajaxPageState":{"theme":"olesain","theme_token":"QcZ-eXygD1igIELy_DsLpEVj0_DxnCrIV-1C7FCSmOc","js":{"misc\/jquery.js":1,"misc\/jquery.once.js":1,"misc\/drupal.js":1,"sites\/all\/modules\/admin_menu\/admin_devel\/admin_devel.js":1,"sites\/all\/modules\/google_analytics\/googleanalytics.js":1,"0":1},"css":{"modules\/system\/system.base.css":1,"modules\/system\/system.menus.css":1,"modules\/system\/system.messages.css":1,"modules\/system\/system.theme.css":1,"modules\/field\/theme\/field.css":1,"modules\/node\/node.css":1,"modules\/user\/user.css":1,"sites\/all\/modules\/views\/css\/views.css":1,"sites\/all\/modules\/ctools\/css\/ctools.css":1,"sites\/all\/modules\/geshifilter\/geshifilter.css":1,"sites\/default\/themes\/olesain\/css\/reset.css":1,"sites\/default\/themes\/olesain\/css\/style.css":1}},"googleanalytics":{"trackOutbound":1,"trackMailto":1,"trackDownload":1,"trackDownloadExtensions":"7z|aac|arc|arj|asf|asx|avi|bin|csv|doc|exe|flv|gif|gz|gzip|hqx|jar|jpe?g|js|mp(2|3|4|e?g)|mov(ie)?|msi|msp|pdf|phps|png|ppt|qtm?|ra(m|r)?|sea|sit|tar|tgz|torrent|txt|wav|wma|wmv|wpd|xls|xml|z|zip"}});
//--><!]]>
</script>
</head>
<body class="html not-front not-logged-in no-sidebars page-node page-node- page-node-161 node-type-article" >
  <div id="skip-link">
    <a href="#main-content" class="element-invisible element-focusable">Skip to main content</a>
  </div>
    <div id="center-col">
  <!--  Main Content Container -->
  <div id="main-wrap">
    <div class="content-wrap">
              <div class="region region-content">
    <div id="block-system-main" class="block block-system">

    
  <div class="content">
    <div id="node-161" class="node node-article node-promoted clearfix">
      <div class="meta clearfix">
      <div class="auth">August 12, 2012</div>
      <div class="created">1:25pm</div>
    </div>
  
    <h2 class="node-title">Templating the Commerce Order Completion Pane</h2>    <div class="tags clearfix"><div class="field field-name-field-blog-tags field-type-taxonomy-term-reference field-label-hidden"><div class="field-items"><div class="field-item even"><a href="../../tags/commerce/" typeof="skos:Concept" property="rdfs:label skos:prefLabel" datatype="">commerce</a></div><div class="field-item odd"><a href="../../tags/7x/" typeof="skos:Concept" property="rdfs:label skos:prefLabel" datatype="">7.x</a></div><div class="field-item even"><a href="../../tags/drupal/" typeof="skos:Concept" property="rdfs:label skos:prefLabel" datatype="">drupal</a></div></div></div></div>

        <div class="field field-name-body field-type-text-with-summary field-label-hidden"><div class="field-items"><div class="field-item even" property="content:encoded"><p>I recently found myself working on a fairly simple Drupal Commerce site.  There weren't a lot of tricks to it, just a few items and an "express" checkout.  So I fired up the <a href="http://drupal.org/project/commerce_kickstart">Commerce Kickstart</a> profile and after a few small tweaks, had it just about right.  As we approached the theme, it became obvious that the commerce completion pane was going to take a lot of love.  The designers had given us a unique layout for how this page should appear, complete with order specific information displayed in a kaleidoscope of containers.  This was going to take some markup, and my first thought was, "it sure would be nice to template this."</p><!--break-->
<p>Turns out that's a fairly simple task thanks to <a href="http://api.drupalcommerce.org/api/Drupal Commerce/sites!all!modules!commerce!modules!checkout!commerce_checkout.api.php/function/hook_commerce_checkout_pane_info_alter/DC">hook_commerce_checkout_pane_info_alter</a>.  The function passes the variable <span class="geshifilter"><code class="php geshifilter-php"><span style="color: #000088;">$checkout_panes</span></code></span> by reference which contains an array of checkout pane arrays.  This function is going to allow us to redefine the function that the checkout completion pane is looking to for output.  This will look something like:</p>
<div class="geshifilter"><div class="drupal6 geshifilter-drupal6" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">function</span> my_module_commerce_checkout_pane_info_alter<span style="color: #66cc66;">(</span><span style="color: #66cc66;">&amp;</span><span style="color: #0000ff;">$checkout_panes</span><span style="color: #66cc66;">)</span> <span style="color: #66cc66;">{</span><br />
  <span style="color: #b1b100;">if</span><span style="color: #66cc66;">(</span><a href="http://www.php.net/isset"><span style="color: #000066;">isset</span></a><span style="color: #66cc66;">(</span><span style="color: #0000ff;">$checkout_panes</span><span style="color: #66cc66;">[</span><span style="color: #ff0000;">'checkout_completion_message'</span><span style="color: #66cc66;">]</span><span style="color: #66cc66;">)</span><span style="color: #66cc66;">)</span> <span style="color: #66cc66;">{</span><br />
    <span style="color: #808080; font-style: italic;">// forget the original include file                     </span><br />
    <a href="http://www.php.net/unset"><span style="color: #000066;">unset</span></a><span style="color: #66cc66;">(</span><span style="color: #0000ff;">$checkout_panes</span><span style="color: #66cc66;">[</span><span style="color: #ff0000;">'checkout_completion_message'</span><span style="color: #66cc66;">]</span><span style="color: #66cc66;">[</span><span style="color: #ff0000;">'file'</span><span style="color: #66cc66;">]</span><span style="color: #66cc66;">)</span>;<br />
    <span style="color: #808080; font-style: italic;">// point at this module</span><br />
    <span style="color: #0000ff;">$checkout_panes</span><span style="color: #66cc66;">[</span><span style="color: #ff0000;">'checkout_completion_message'</span><span style="color: #66cc66;">]</span><span style="color: #66cc66;">[</span><span style="color: #ff0000;">'module'</span><span style="color: #66cc66;">]</span> = <span style="color: #ff0000;">'my_module'</span>;<br />
    <span style="color: #808080; font-style: italic;">// register the new output function</span><br />
    <span style="color: #0000ff;">$checkout_panes</span><span style="color: #66cc66;">[</span><span style="color: #ff0000;">'checkout_completion_message'</span><span style="color: #66cc66;">]</span><span style="color: #66cc66;">[</span><span style="color: #ff0000;">'base'</span><span style="color: #66cc66;">]</span> = <span style="color: #ff0000;">'my_module_completion_message_pane'</span>;<br />
  <span style="color: #66cc66;">}</span><br /><span style="color: #66cc66;">}</span></div></div>
<p>The function name we passed above will have <span class="geshifilter"><code class="php geshifilter-php">_checkout_form</code></span> appended.  We will need to declare a function to satisfy this  and return our output.</p>
<div class="geshifilter"><div class="drupal6 geshifilter-drupal6" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">function</span> my_module_completion_message_pane_checkout_form<span style="color: #66cc66;">(</span><span style="color: #0000ff;">$form</span>, <span style="color: #66cc66;">&amp;</span><span style="color: #0000ff;">$form_state</span>, <span style="color: #0000ff;">$checkout_pane</span>, <span style="color: #0000ff;">$order</span><span style="color: #66cc66;">)</span> <span style="color: #66cc66;">{</span><br />
  <span style="color: #0000ff;">$pane_form</span> = <a href="http://www.php.net/array"><span style="color: #000066;">array</span></a><span style="color: #66cc66;">(</span><span style="color: #66cc66;">)</span>;<br />
  <span style="color: #0000ff;">$pane_form</span><span style="color: #66cc66;">[</span><span style="color: #ff0000;">'message'</span><span style="color: #66cc66;">]</span> = <a href="http://www.php.net/array"><span style="color: #000066;">array</span></a><span style="color: #66cc66;">(</span><span style="color: #ff0000;">'#markup'</span> =<span style="color: #66cc66;">&gt;</span> <span style="color: #808080; font-style: italic;">/*markup*/</span><span style="color: #66cc66;">)</span>;<br />
  <span style="color: #b1b100;">return</span> <span style="color: #0000ff;">$pane_form</span>;<br /><span style="color: #66cc66;">}</span></div></div>
<p>From here, we're basically home free.  We simply need to replace <span class="geshifilter"><code class="php geshifilter-php"><span style="color: #666666; font-style: italic;">/*markup*/</span></code></span> with the output we desire.  Since we are looking to template this, we will need to register a theme implementation for it.  The important thing to note is the <span class="geshifilter"><code class="php geshifilter-php"><span style="color: #000088;">$order</span></code></span> variable passed to this function.  We'll need that order information in our template, so we pass it along while laying out our <span class="geshifilter"><code class="php geshifilter-php">hook_theme</code></span> call.</p>
<div class="geshifilter"><div class="drupal6 geshifilter-drupal6" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">function</span> my_module_theme<span style="color: #66cc66;">(</span><span style="color: #0000ff;">$existing</span>, <span style="color: #0000ff;">$type</span>, <span style="color: #0000ff;">$theme</span>, <span style="color: #0000ff;">$path</span><span style="color: #66cc66;">)</span> <span style="color: #66cc66;">{</span><br />
  <span style="color: #b1b100;">return</span> <a href="http://www.php.net/array"><span style="color: #000066;">array</span></a><span style="color: #66cc66;">(</span><br />
    <span style="color: #ff0000;">'my_module_completion'</span> =<span style="color: #66cc66;">&gt;</span> <a href="http://www.php.net/array"><span style="color: #000066;">array</span></a><span style="color: #66cc66;">(</span><br />
      <span style="color: #808080; font-style: italic;">// the template filename, .tpl.php will be appended</span><br />
      <span style="color: #ff0000;">'template'</span> =<span style="color: #66cc66;">&gt;</span> <span style="color: #ff0000;">'my_module_completion'</span>,<br />
      <span style="color: #808080; font-style: italic;">// include order as a variable in the template</span><br />
      <span style="color: #ff0000;">'variables'</span> =<span style="color: #66cc66;">&gt;</span> <a href="http://www.php.net/array"><span style="color: #000066;">array</span></a><span style="color: #66cc66;">(</span><span style="color: #ff0000;">'order'</span> =<span style="color: #66cc66;">&gt;</span> <span style="color: #000000; font-weight: bold;">NULL</span><span style="color: #66cc66;">)</span>,<br />
    <span style="color: #66cc66;">)</span>,<br />
  <span style="color: #66cc66;">)</span>;<br /><span style="color: #66cc66;">}</span> </div></div>
<p>Now that we have a theme implementation that is expecting an order variable, all that remains is to call it as the value for <span class="geshifilter"><code class="php geshifilter-php"><span style="color: #0000ff;">'#markup'</span></code></span> in our output function above.</p>
<div class="geshifilter"><div class="drupal6 geshifilter-drupal6" style="font-family:monospace;"><span style="color: #0000ff;">$pane_form</span><span style="color: #66cc66;">[</span><span style="color: #ff0000;">'message'</span><span style="color: #66cc66;">]</span> = <a href="http://www.php.net/array"><span style="color: #000066;">array</span></a><span style="color: #66cc66;">(</span><span style="color: #ff0000;">'#markup'</span> =<span style="color: #66cc66;">&gt;</span> <a href="http://api.drupal.org/api/function/theme/6"><span style="color: #000066;">theme</span></a><span style="color: #66cc66;">(</span><span style="color: #ff0000;">'my_module_completion'</span>, <a href="http://www.php.net/array"><span style="color: #000066;">array</span></a><span style="color: #66cc66;">(</span><span style="color: #ff0000;">'order'</span> =<span style="color: #66cc66;">&gt;</span> <span style="color: #0000ff;">$order</span><span style="color: #66cc66;">)</span><span style="color: #66cc66;">)</span><span style="color: #66cc66;">)</span>;</div></div>
<p>From here simply create the <span class="geshifilter"><code class="php geshifilter-php">my_module_completion<span style="color: #339933;">.</span>tpl<span style="color: #339933;">.</span>php</code></span> file and theme away!  The template will have our order information exposed as the php variable <span class="geshifilter"><code class="php geshifilter-php"><span style="color: #000088;">$order</span></code></span> allowing us to output whatever order information we would like.  This is probably a good time to note, that the <span class="geshifilter"><code class="php geshifilter-php"><span style="color: #000088;">$order</span></code></span> variable very well may not be sufficient (it wasn't for us).  It contains mostly keys to fetch other bits of data about the order.  In our actual implementation we wound up loading the line item (our implementation only allowed one), and some customer information.  This can easily be done from the output function you define in <span class="geshifilter"><code class="php geshifilter-php">hook_commerce_checkout_pane_info_alter</code></span> and passed to the template exactly as we did the order variable in this example.</p>
<p><em>I admit that this is bordering on being somewhat hackish.</em>  I don't think I would take this approach if the Commerce implementation was more complex.  If that were the case a better approach may be to <a href="http://api.drupalcommerce.org/api/Drupal Commerce/sites%21all%21modules%21commerce%21modules%21checkout%21commerce_checkout.api.php/function/hook_commerce_checkout_pane_info/DC">create a custom checkout pane</a>  with the output you would like, assign it to the appropriate checkout pages, and leave the poor checkout completion pane alone.  However, in the interest of time and ease in satisfying a theme requirement for a relatively small site, this method worked like a charm.  Further, I don't believe that anything has been obfuscated.  With some light commenting it should be apparent to anyone who reviews this code, exactly what is going on.  With that in mind, take this method as a handy <em>trick</em> if you need to quickly and drastically rework how the checkout completion pane is displayed.</p></div></div></div>
    <div class="meta clearfix">
      </div>
  <div class="olesain-comments clearfix">
          </div>
</div>  </div>
</div>
  </div>
    </div>
  </div>
</div>
<!-- Header -->
<div id="meta-header" class="clearfix">
  <div class="header-content">
    <h1 class="logo"><a href="../../">
      <span class="name">Ryan Oles</span>
      <span class="name site-name">the<span class="color-orng">oles</span>chool.com</span>
    </a></h1>
        <!-- Navigation -->
          <div id="main-menu" class="top-nav clearfix">
        <h2 class="element-invisible">Main menu</h2><ul id="main-menu-nav" class="links clearfix"><li class="menu-345 first"><a href="../../about/">About</a></li>
<li class="menu-275 last"><a href="../../" title="go back to front page">Home</a></li>
</ul>      </div>
      </div>
</div>  </body>

<!-- Mirrored from theoleschool.com/blog/templating-commerce-order-completion-pane by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 26 Sep 2015 17:07:12 GMT -->
</html>
