<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML+RDFa 1.0//EN"
  "http://www.w3.org/MarkUp/DTD/xhtml-rdfa-1.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" version="XHTML+RDFa 1.0" dir="ltr"
  xmlns:content="http://purl.org/rss/1.0/modules/content/"
  xmlns:dc="http://purl.org/dc/terms/"
  xmlns:foaf="http://xmlns.com/foaf/0.1/"
  xmlns:og="http://ogp.me/ns#"
  xmlns:rdfs="http://www.w3.org/2000/01/rdf-schema#"
  xmlns:sioc="http://rdfs.org/sioc/ns#"
  xmlns:sioct="http://rdfs.org/sioc/types#"
  xmlns:skos="http://www.w3.org/2004/02/skos/core#"
  xmlns:xsd="http://www.w3.org/2001/XMLSchema#">


<!-- Mirrored from theoleschool.com/blog/adopting-table-schema-using-data-module by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 26 Sep 2015 17:07:20 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head profile="http://www.w3.org/1999/xhtml/vocab">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta content="Adopting a Table with Schema using Data Module" about="/blog/adopting-table-schema-using-data-module" property="dc:title" />
<link rel="shortcut icon" href="../../misc/favicon/index.ico" type="image/vnd.microsoft.icon" />
<meta name="generator" content="Drupal 7 (http://drupal.org)" />
<meta name="keywords" content="drupal, web development" />
<link rel="canonical" href="index.html" />
<link rel="shortlink" href="index.html" />
  <title>Adopting a Table with Schema using Data Module | theoleschool</title>
  <link type="text/css" rel="stylesheet" href="../../sites/default/files/css/css_pbm0lsQQJ7A7WCCIMgxLho6mI_kBNgznNUWmTWcnfoE/index.css" media="all" />
<link type="text/css" rel="stylesheet" href="../../sites/default/files/css/css_botNHIYRQPys-RH2iA3U4LbV9bPNRS64tLAs8ec1ch8/index.css" media="all" />
<link type="text/css" rel="stylesheet" href="../../sites/default/files/css/css_ggwmJjnSHIyQGr6BcS46i7z-SeJR7vFJ2H8b7fsUJ1o/index.css" media="all" />
<link type="text/css" rel="stylesheet" href="../../sites/default/files/css/css_wTnXwKLp1ec_eSA6aRSbc1Cr7mXlDTPbLelDm9ZTjQg/index.css" media="screen" />
  <script type="text/javascript" src="../../sites/default/files/js/js_xAPl0qIk9eowy_iS9tNkCWXLUVoat94SQT48UBCFkyQ/index.js"></script>
<script type="text/javascript" src="../../sites/default/files/js/js_mEEqrZApHAidJyywsmZR_Ac1d4B-4FLzvR9sbsjVDyg/index.js"></script>
<script type="text/javascript" src="../../sites/default/files/js/js_IDBX5SzkJ9gGNq7x-qOE_2DZsexqguTJQGMKvi4w-Uw/index.js"></script>
<script type="text/javascript">
<!--//--><![CDATA[//><!--
var _gaq = _gaq || [];_gaq.push(["_setAccount", "UA-25692833-1"]);_gaq.push(["_trackPageview"]);(function() {var ga = document.createElement("script");ga.type = "text/javascript";ga.async = true;ga.src = "../../sites/default/files/googleanalytics/ga/index.js?nvammp";var s = document.getElementsByTagName("script")[0];s.parentNode.insertBefore(ga, s);})();
//--><!]]>
</script>
<script type="text/javascript">
<!--//--><![CDATA[//><!--
jQuery.extend(Drupal.settings, {"basePath":"\/","pathPrefix":"","ajaxPageState":{"theme":"olesain","theme_token":"howJGS8WMpGMHsRWxS_q_WysuX5PxIp2wG_2QBgnq94","js":{"misc\/jquery.js":1,"misc\/jquery.once.js":1,"misc\/drupal.js":1,"sites\/all\/modules\/admin_menu\/admin_devel\/admin_devel.js":1,"sites\/all\/modules\/google_analytics\/googleanalytics.js":1,"0":1},"css":{"modules\/system\/system.base.css":1,"modules\/system\/system.menus.css":1,"modules\/system\/system.messages.css":1,"modules\/system\/system.theme.css":1,"modules\/field\/theme\/field.css":1,"modules\/node\/node.css":1,"modules\/user\/user.css":1,"sites\/all\/modules\/views\/css\/views.css":1,"sites\/all\/modules\/ctools\/css\/ctools.css":1,"sites\/all\/modules\/geshifilter\/geshifilter.css":1,"sites\/default\/themes\/olesain\/css\/reset.css":1,"sites\/default\/themes\/olesain\/css\/style.css":1}},"googleanalytics":{"trackOutbound":1,"trackMailto":1,"trackDownload":1,"trackDownloadExtensions":"7z|aac|arc|arj|asf|asx|avi|bin|csv|doc|exe|flv|gif|gz|gzip|hqx|jar|jpe?g|js|mp(2|3|4|e?g)|mov(ie)?|msi|msp|pdf|phps|png|ppt|qtm?|ra(m|r)?|sea|sit|tar|tgz|torrent|txt|wav|wma|wmv|wpd|xls|xml|z|zip"}});
//--><!]]>
</script>
</head>
<body class="html not-front not-logged-in no-sidebars page-node page-node- page-node-156 node-type-article" >
  <div id="skip-link">
    <a href="#main-content" class="element-invisible element-focusable">Skip to main content</a>
  </div>
    <div id="center-col">
  <!--  Main Content Container -->
  <div id="main-wrap">
    <div class="content-wrap">
              <div class="region region-content">
    <div id="block-system-main" class="block block-system">

    
  <div class="content">
    <div id="node-156" class="node node-article node-promoted clearfix">
      <div class="meta clearfix">
      <div class="auth">March 3, 2012</div>
      <div class="created">2:19pm</div>
    </div>
  
    <h2 class="node-title">Adopting a Table with Schema using Data Module</h2>    <div class="tags clearfix"><div class="field field-name-field-blog-tags field-type-taxonomy-term-reference field-label-hidden"><div class="field-items"><div class="field-item even"><a href="../../tags/data-module/index.html" typeof="skos:Concept" property="rdfs:label skos:prefLabel" datatype="">data module</a></div><div class="field-item odd"><a href="../../tags/schema/index.html" typeof="skos:Concept" property="rdfs:label skos:prefLabel" datatype="">schema</a></div><div class="field-item even"><a href="../../tags/6x/index.html" typeof="skos:Concept" property="rdfs:label skos:prefLabel" datatype="">6.x</a></div><div class="field-item odd"><a href="../../tags/drupal/index.html" typeof="skos:Concept" property="rdfs:label skos:prefLabel" datatype="">drupal</a></div></div></div></div>

        <div class="field field-name-body field-type-text-with-summary field-label-hidden"><div class="field-items"><div class="field-item even" property="content:encoded"><p>When working with medium to larger sized web applications, inevitably the requirement comes up for some advanced data reporting.  The spectrum of requests here can obviously be pretty broad and is often beyond what you can accomplish with the default tables provided by Drupal and the installed modules.  This tends to lead us to creating custom tables to track and manage the requested reports.  Along with writing all of the necessary <a href="http://en.wikipedia.org/wiki/Create,_read,_update_and_delete">CRUD</a> functions to make sure our new table is managing data appropriately,  we also have to provide some sort of display or an export.  Views can handle this latter requirement quite nicely.  So it is here that we can turn to modules like  <a href="http://drupal.org/project/data">Data</a> or the now depricated <a href="http://drupal.org/project/tw">Table Wizard</a> to bring our new table under views "control." This gives us the added bonus of taking the display configuration out of the hands of the developer and placing it into the site builder/administrator's domain.</p>
<p>In a recent project just such a reporting request came up.  The report was fairly complex and was to be visible to a larger subset of users.  I wound up managing this report with a custom table and I turned to Data module to allow views to handle the output.  After installing my custom module which created the custom table, I navigated to <span class="geshifilter"><code class="php geshifilter-php">admin<span style="color: #339933;">/</span>build<span style="color: #339933;">/</span>data<span style="color: #339933;">/</span>adopt</code></span>. Expecting to see my table in the list of "adoptable" tables, I was a bit confused when it was nowhere to be found.  After <a href="http://drupal.org/node/888946#comment-3360326">a bit of digging</a> I realized that tables declared using <a href="http://drupal.org/node/146843">Schema API</a> were considered "owned" by the module and not included in the list of adoptable tables.  This makes some sense as you don't want just any table adopted by Data.  Just imagine when an admin who's not quite sure what he or she is doing, decides to adopt and then drop the node table. I'd rather not...</p>
<p>So this leaves us with the question, <em>"How do I get Data module to adopt my table?"</em>  From what I can tell, the creators of the data module expect us to use the Data API to handle table creation and CRUD.  Personally I don't like the idea of this.  I already understand and like working with Drupal's core Schema API, and don't want to adopt another layer of abstraction.  I only want to utilize Data module to throw my table up to views.  So after looking through how adoption is handled in the module, I found that really there is nothing preventing Data from adopting these schema declared tables. They are simply being made unavailable to the form at <span class="geshifilter"><code class="php geshifilter-php">admin<span style="color: #339933;">/</span>build<span style="color: #339933;">/</span>data<span style="color: #339933;">/</span>adopt</code></span>.  This lead me to attempt to adopt my table right after it is generated in my module's .install file.   This wound up working quite nicely and is implemented as follows:</p>
<div class="geshifilter"><div class="drupal6 geshifilter-drupal6" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">function</span> my_module_install<span style="color: #66cc66;">(</span><span style="color: #66cc66;">)</span> <span style="color: #66cc66;">{</span><br />
  <span style="color: #808080; font-style: italic;">//install schema as normal</span><br />
  <a href="http://api.drupal.org/api/function/drupal_install_schema/6"><span style="color: #000066;">drupal_install_schema</span></a><span style="color: #66cc66;">(</span><span style="color: #ff0000;">'my_table'</span><span style="color: #66cc66;">)</span>;<br />
  <br />
  <span style="color: #808080; font-style: italic;">//make sure we have the data module</span><br />
  <span style="color: #b1b100;">include_once</span><span style="color: #66cc66;">(</span><a href="http://api.drupal.org/api/function/drupal_get_path/6"><span style="color: #000066;">drupal_get_path</span></a><span style="color: #66cc66;">(</span><span style="color: #ff0000;">'module'</span>, <span style="color: #ff0000;">'data'</span><span style="color: #66cc66;">)</span> .<span style="color: #ff0000;">'/data.module'</span><span style="color: #66cc66;">)</span>;<br />
  data_include<span style="color: #66cc66;">(</span><span style="color: #ff0000;">'DataTable'</span><span style="color: #66cc66;">)</span>;<br />
  <span style="color: #808080; font-style: italic;">//instanciate the table we just created with the DataTable class</span><br />
  <span style="color: #0000ff;">$my_table_object</span> = DataTable::<span style="color: #006600;">instance</span><span style="color: #66cc66;">(</span><span style="color: #ff0000;">'my_table'</span><span style="color: #66cc66;">)</span>;<br />
  <span style="color: #808080; font-style: italic;">//tell Data module to adopt the table</span><br />
  <span style="color: #0000ff;">$my_table_object</span>-<span style="color: #66cc66;">&gt;</span><span style="color: #006600;">adopt</span><span style="color: #66cc66;">(</span><span style="color: #66cc66;">)</span>;<br />
  DataTable::<span style="color: #006600;">clearCaches</span><span style="color: #66cc66;">(</span><span style="color: #66cc66;">)</span>;<br /><span style="color: #66cc66;">}</span></div></div>
<p>After installing the module you should be able to see your custom table at <span class="geshifilter"><code class="php geshifilter-php">admin<span style="color: #339933;">/</span>build<span style="color: #339933;">/</span>data</code></span>.  Data module is now obviously a dependency so be sure that it is installed and enabled before installing your custom module.</p>
<p>I realize that I could write my own views handlers for the custom table data I am providing, but I have found that to be a fairly time consuming (and often esoteric) task.  When all we are after is  a single, somewhat unique report, I feel that integration with the Data module and it's corresponding integration with views is simple, quick, and more than adequate.</p></div></div></div>
    <div class="meta clearfix">
      </div>
  <div class="olesain-comments clearfix">
          </div>
</div>  </div>
</div>
  </div>
    </div>
  </div>
</div>
<!-- Header -->
<div id="meta-header" class="clearfix">
  <div class="header-content">
    <h1 class="logo"><a href="../../index/index.html">
      <span class="name">Ryan Oles</span>
      <span class="name site-name">the<span class="color-orng">oles</span>chool.com</span>
    </a></h1>
        <!-- Navigation -->
          <div id="main-menu" class="top-nav clearfix">
        <h2 class="element-invisible">Main menu</h2><ul id="main-menu-nav" class="links clearfix"><li class="menu-345 first"><a href="../../about/index.html">About</a></li>
<li class="menu-275 last"><a href="../../index/index.html" title="go back to front page">Home</a></li>
</ul>      </div>
      </div>
</div>  </body>

<!-- Mirrored from theoleschool.com/blog/adopting-table-schema-using-data-module by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 26 Sep 2015 17:07:20 GMT -->
</html>
